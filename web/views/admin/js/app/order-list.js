function returnSearchParams(){var a=$("#user-name").val(),b=$("#order-num").val(),c=$("#total-amount").val(),d=$("#phone-num").val(),e=$("#date").val(),f=$("#delivery-type").val();return status=$("#order-status-filter option:selected").val(),searchParams={},searchParams={userName:a,orderNum:b,total:c,phone_num:d,date:e,status:status,delivery_type:f},searchParams}function updateOrders(a,b){var c=baseURL+"cms/update_order/"+b+"/",d={"session-key":localStorage.session_key},e={status:a};data=JSON.stringify(e);var f=new AjaxHttpSender;f.sendPost(c,d,data,updateOrdersCallback)}function getOrders(a,b,c,d,e,f,g,h){$("#order-list tbody").empty();var i=baseURL+"cms/get_orders/",j={"session-key":localStorage.session_key},k={nextPage:a,search:b,num:c,status:d,phone:f,date:g,amount:e,delivery_type:h};data=JSON.stringify(k);var l=new AjaxHttpSender;l.sendPost(i,j,data,getOrdersCallback)}function getOrderDetails(a){var b=baseURL+"cms/get_order_details/"+a+"/",c={"session-key":localStorage.session_key},d={};data=JSON.stringify(d);var e=new AjaxHttpSender;e.sendPost(b,c,data,getOrderDetailsCallback)}function deleteOrder(a){var b=baseURL+"cms/delete_order/"+a+"/",c={"session-key":localStorage.session_key},d={};data=JSON.stringify(d);var e=new AjaxHttpSender;e.sendPost(b,c,data,deleteOrderCallback)}function populateOrderList(a){var b=JSON.parse(a);$.each(b.aaData,function(a,b){var c=b.delivery_time,d=convertToMeridianTime(c);$("#order-list tbody").append("<tr data-id='"+b.id+"'><td>"+b.order_num+"</td><td>"+b.user_first_name+" "+b.user_last_name+"</td><td>"+b.phone+"</td><td>"+d.date+"<br>"+d.time+"</td><td>"+b.delivery_type+"</td><td>"+dollarConvert(parseFloat(b.grand_total).toFixed(2))+"</td><td class='no-popup'><select data-id='"+b.id+"'class='order-status' name='status'><option value='0'>Placed</option><option value='1'>Packed</option><option value='2'>Dispatched</option><option value='3'>Delivered</option><option value='4'>Cancelled</option></select></td><td class='no-popup'><a class='meal-delete cross' data-id='"+b.id+"'></a></td></tr>"),currentStatus=b.status_id,$(".order-status:last").val(currentStatus)}),$(".pagination").pagination({pages:b.num_pages,currentPage:b.current_page,cssStyle:"light-theme",onPageClick:function(a,b){searchParams=returnSearchParams(),getOrders(a,searchParams.userName,searchParams.orderNum,searchParams.status,searchParams.total,searchParams.phone_num,searchParams.date)},onInit:function(){if(getStringAfterHash(location.href,"#")){var a=getStringAfterHash(location.href,"#");-1!=a.indexOf("page")&&(pageNumber=getStringAfterHash(a,"-"),$(".pagination").pagination("getCurrentPage")==pageNumber||$(".pagination").pagination("selectPage",pageNumber))}}})}function populateOrderDetails(a){var b=$(".order-detail-popup").find(".order-address"),c=$(".order-detail-popup");$(".order-list-items").remove();var d=a.order.delivery_time,e=convertToMeridianTime(d),f=a.order.payment_date;"Not Available"!==f?(medidianPaymentTime=convertToMeridianTime(f),c.find(".order-payment_date").text(medidianPaymentTime.date+" "+medidianPaymentTime.time)):c.find(".order-payment_date").text(f),c.find(".order-num").text("#"+a.order.order_num),c.find(".order-status-message").text(a.order.status),c.find(".order-name").text(a.order.user_first_name+" "+a.order.user_last_name),c.find(".order-total").text(dollarConvert(a.order.grand_total)),c.find(".order-date").text(e.date+" "+e.time),c.find(".order-payment_type").text(a.order.delivery_type),c.find(".order-transaction_id").text(a.order.transaction_id),"Pickup"==a.order.delivery_type?b.find(".building").text("Pickup"):(b.find(".company").text(void 0===a.order.delivery_address.company?"":a.order.delivery_address.company),b.find(".building").text(a.order.delivery_address.building),b.find(".street").text(a.order.delivery_address.street),b.find(".city-state").text(a.order.delivery_address.city+" "+a.order.delivery_address.state),b.find(".zip").text(a.order.delivery_address.zip)),$.each(a.order.meals,function(a,b){$(".order-meal").append("<div class='order-list-items' data-id='"+b.id+"'><img src='"+b.image+"'><span class='body-text-small'>"+b.name+"</span><div class='quantity-container'><input type='text' disabled='disabled' class='quantity' value='"+b.quantity+"'></div><span class='price-container' data-tax='"+b.tax+"'>"+dollarConvert(parseFloat(b.tax+b.price).toFixed(2))+"</span></div>")})}$(document).ready(function(){getOrders(),setInterval(function(){getOrders()},6e4),$(document).on("click","#order-list td:not(.no-popup)",function(){currentOrderId=$(this).parent().data().id,getOrderDetails(currentOrderId)}),$(".remove").on("click",function(){$(".order-detail-popup").hide()}),$(document).on("click",".meal-delete",function(){OrderId=$(this).data().id,confirm("Are you sure you want to delete this order?")&&deleteOrder(OrderId)}),$("#search-orders").on("click",function(){searchParams=returnSearchParams(),getOrders(1,searchParams.userName,searchParams.orderNum,searchParams.status,searchParams.total,searchParams.phone_num,searchParams.date,searchParams.delivery_type)}),$(document).on("change",".order-status",function(){var a=this.value,b=$(this).data().id;updateOrders(a,b)}),$("#date").datepicker(),downloadOrderCSV("cms/export_orders/","download-orders-form")});var updateOrdersCallback={success:function(a,b){console.log("Order Updated")},failure:function(a,b,c){}},getOrdersCallback={success:function(a,b){var c=JSON.parse(a);1==c.status&&(c.aaData.length>0?($(".order-list-empty").hide(),populateOrderList(a)):($(".order-list-empty").show(),$(".pagination").pagination({pages:0,cssStyle:"light-theme"})))},failure:function(a,b,c){}},getOrderDetailsCallback={success:function(a,b){var c=JSON.parse(a);1==c.status&&($(".order-detail-popup").show(),populateOrderDetails(c))},failure:function(a,b,c){}},deleteOrderCallback={success:function(a,b){var c=JSON.parse(a);if(1==c.status){var d=returnSearchParams();currentPage=$(".pagination").pagination("getCurrentPage"),getOrders(currentPage,d.userName,d.orderNum,d.status,d.total,d.phone_num,d.date,d.delivery_type)}},failure:function(a,b,c){}};