function listPromoCode(a){var b=baseURL+"cms/list_promocodes/";header={"session-key":localStorage.session_key},params={nextPage:a},data=JSON.stringify(params);var c=new AjaxHttpSender;c.sendPost(b,header,data,listPromoCodeCallback)}function populatePromoCodes(a){$("#promocodes-list tbody").empty(),0==a.aaData.length?$("#promocodes-list-empty").show():($.each(a.aaData,function(a,b){$("#promocodes-list tbody").append("<tr class='row' data-id='"+b.id+"'><td class='card-code'>"+b.code+"</td><td class='card-name' data-date='"+b.expiry_date_format+"'>"+b.expiry_date+"</td><td class='card-amount' data-amount='"+b.amount+"'>"+dollarConvert(b.amount)+"</td><td class='no-popup'><button type='button' class='promocard-edit btn btn-small-primary medium-green' data-id='"+b.id+"'>Edit</button></td><td class='no-popup'><button type='button' class='promocard-delete btn btn-small-primary medium-green' data-id='"+b.id+"'>Delete</button></td></tr>"),b.status?$("tbody .row:last").append("<td><button data-id='"+b.id+"' class='status down'>Active</button></td>"):$("tbody .row:last").append("<td><button data-id='"+b.id+"' class='status'>Inactive</button></td>")}),$(".pagination").pagination({pages:a.num_pages,currentPage:a.current_page,cssStyle:"light-theme",onPageClick:function(a,b){listPromoCode(a)},onInit:function(){if(getStringAfterHash(location.href,"#")){var a=getStringAfterHash(location.href,"#");-1!=a.indexOf("page")&&(pageNumber=getStringAfterHash(a,"-"),$(".pagination").pagination("getCurrentPage")==pageNumber||$(".pagination").pagination("selectPage",pageNumber))}}})),$(".popup-wrapper").hide()}function managePromoCodes(a){var b=baseURL+"cms/manage_promocode/",c={"session-key":localStorage.session_key},d={edit_id:a.editId,delete_id:a.deleteId,code:a.code,expiry_date:a.name,amount:a.amount};$.each(d,function(a,b){giftcardEmptyCheck(a,b)}),data=JSON.stringify(d);var e=new AjaxHttpSender;e.sendPost(b,c,data,manageGiftcardsCallback)}function giftcardEmptyCheck(a,b){b&&(giftcardParams[a]=b)}function updatePromocodeStatus(a,b){var c=baseURL+"cms/change_promocode_status/";header={"session-key":localStorage.session_key},params={id:a,status:b},data=JSON.stringify(params);var d=new AjaxHttpSender;d.sendPost(c,header,data,PromocodeStatusCallback)}$(document).ready(function(){listPromoCode(0),giftcardParams={},$(document).on("click",".promocard-delete",function(){giftcardParams={},cardId=$(this).data().id,confirm("Are you sure you want to delete?")&&(giftcardParams.deleteId=cardId,managePromoCodes(giftcardParams))}),$(document).on("click",".promocard-edit",function(){giftcardParams={},$this=$(this);var a=$this.parents().eq(1).find(".card-code").text(),b=$this.parents().eq(1).find(".card-name").data().date,c=$this.parents().eq(1).find(".card-amount").data("amount");$("#new-code").val(a),$("#new-date").val(b),$("#new-amount").val(c),$("#update").data("id",$this.data("id")),$("#update").text("update"),$(".popup-wrapper").show(),$("form#promocode-form").validate().resetForm()}),$(document).on("click","#add-new-promo",function(){$("#update").text("add"),$("form#promocode-form")[0].reset(),$(".popup-wrapper").show()}),$("#update").on("click",function(){if($("#promocode-form").valid())if("add"==$("#update").text()){var a=$("#new-code").val(),b=$("#new-date").val(),c=$("#new-amount").val(),d={code:a,name:b,amount:c};managePromoCodes(d)}else{var a=$("#new-code").val(),b=$("#new-date").val(),c=$("#new-amount").val(),e=$(this).data("id");giftcardDetails={editId:e,code:a,name:b,amount:c},managePromoCodes(giftcardDetails)}}),$(document).on("click",".status",function(){var a,b;a=$(this).attr("data-id"),$(this).hasClass("down")?(b=0,$(this).removeClass("down"),$(this).text("Inactive")):(b=1,$(this).addClass("down"),$(this).text("Active")),updatePromocodeStatus(a,b)}),$("#new-date").datepicker({minDate:new Date}),$("#new-date").datepicker()});var listPromoCodeCallback={success:function(a,b){var c=JSON.parse(a);1==c.status?populatePromoCodes(c):showErrorPopup(c)},failure:function(a,b,c){}},manageGiftcardsCallback={success:function(a,b){var c=JSON.parse(a);1==c.status?(currentPage=$(".pagination").pagination("getCurrentPage"),listPromoCode(currentPage)):showErrorPopup(c)},failure:function(a,b,c){}},PromocodeStatusCallback={success:function(a,b){var c=JSON.parse(a);1==c.status},failure:function(a,b,c){}};