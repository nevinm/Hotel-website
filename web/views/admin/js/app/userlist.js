function getUserlist(a){var b=baseURL+"cms/get_users/";header={"session-key":localStorage.session_key},params={nextPage:a},data=JSON.stringify(params);var c=new AjaxHttpSender;c.sendPost(b,header,data,getUserlistCallback)}function updateUserStatus(a,b){var c=baseURL+"cms/change_user_status/";header={"session-key":localStorage.session_key},params={id:a,is_active:b},data=JSON.stringify(params);var d=new AjaxHttpSender;d.sendPost(c,header,data,updateUserStatusCallback)}function populateUserlist(a){$("#userlist tbody").empty(),$.each(a.aaData,function(a,b){var c="<tr class='row'><td class='name'>"+b.name+"</td><td class='credits'>"+b.credits+"<p data-credits='"+parseFloat(b.credits.substring(2))+"' data-id='"+b.id+"' data-name='"+b.name+"' class='credits-edit'>EDIT</p></td><td class='email'>"+b.email+"</td><td class='is_admin'>"+b.is_admin+"</td><td class='is_ambassador'>";c+="<div>"+b.ambassador_code+"</div></td><td class='mobile'>"+b.mobile+"</td><td class='profile_image'><img src='"+b.profile_image+"'/></td><td align='center' class='delete-user'><a data-id='"+b.id+"'class='cross'></a></td></tr>",$("#userlist tbody").append(c),b.is_active?$("tbody .row:last").append("<td><button data-id='"+b.id+"' class='status down'>Active</button></td>"):$("tbody .row:last").append("<td><button data-id='"+b.id+"' class='status'>Inactive</button></td>"),"Not Available"==b.profile_image&&($(".profile_image img:last").remove(),$(".profile_image:last").html("Not Available"))}),$(".credits-edit").on("click",function(){showUserCreditEditPopup(this)}),$(".pagination").pagination({items:a.total_count,itemsOnPage:a.per_page,currentPage:a.current_page,cssStyle:"light-theme",onPageClick:function(a,b){getUserlist(a)},onInit:function(){if(getStringAfterHash(location.href,"#")){var a=getStringAfterHash(location.href,"#");-1!=a.indexOf("page")&&(pageNumber=getStringAfterHash(a,"-"),$(".pagination").pagination("getCurrentPage")==pageNumber||$(".pagination").pagination("selectPage",pageNumber))}}}),$(".status").click(function(){var a,b;$(this).hasClass("down")?(a=$(this).data().id,b=!1,updateUserStatus(a,b),$(this).removeClass("down"),$(this).text("Inactive")):(a=$(this).data().id,b=!0,updateUserStatus(a,b),$(this).addClass("down"),$(this).text("Active"))}),$("a[id^=ambassador-]").on("click",function(a){a.preventDefault(),setAmbassadorStatus(a,this)})}function setAmbassadorStatus(a,b){var c=baseURL+"cms/set_ambassador/";header={"session-key":localStorage.session_key},params={id:$(b).attr("data-id"),is_ambassador:$(b).hasClass("not-ambassador")?1:0},data=JSON.stringify(params),(new AjaxHttpSender).sendPost(c,header,data,setAmbassadorCallback,b)}function showUserCreditEditPopup(a){$("#user-credit-form .credits").show(),$("#update-user-credits").show(),$("#user-credit-form .content").hide(),$(".user-list-popup .header").text("Update User Credits");var b=$(a).data("id"),c=($(a).find(".credits").val(),$(a).data("name"));$("#new-credits").val($(a).data("credits")),$("#update-user-credits").data("id",b),$("#update-user-credits").data("user",c),$("#current-user").text(c),$(".popup-wrapper").show()}function showUserCreditPoup(){$(".user-list-popup .header").text("Message"),$("#user-credit-form .credits").hide(),$("#update-user-credits").hide(),$("#user-credit-form .content").show(),showPopup(usersData)}function removeUsers(a){if(confirm("Are you sure you want to delete this user?")){var b=baseURL+"cms/delete_user/";header={"session-key":localStorage.session_key},params={id:a},data=JSON.stringify(params);var c=new AjaxHttpSender;c.sendPost(b,header,data,removeUsersCallback)}}function manageCredits(a,b){var c=baseURL+"cms/manage_credits/";header={"session-key":localStorage.session_key},params={user_id:a,credit:b},data=JSON.stringify(params);var d=new AjaxHttpSender;d.sendPost(c,header,data,manageCreditsCallback)}var getUserlistCallback={success:function(a,b){var c=JSON.parse(a);populateUserlist(c)},failure:function(a,b,c){}},updateUserStatusCallback={success:function(a,b){var c=JSON.parse(a);0==c.is_active?userActive=!1:userActive=!0},failure:function(a,b,c){}},setAmbassadorCallback={success:function(a,b,c){var d=JSON.parse(a);if(1==d.status){var e=JSON.parse(a);e.is_ambassador?($(c).text("YES"),$(c).removeClass("not-ambassador").addClass("ambassador")):($(c).removeClass("ambassador").addClass("not-ambassador"),$(c).text("NO"))}},failure:function(a,b,c){}},removeUsersCallback={success:function(a,b){var c=JSON.parse(a);1==c.status?(currentPage=$(".pagination").pagination("getCurrentPage"),getUserlist(currentPage)):showUserCreditPoup(c)},failure:function(a,b,c){}},manageCreditsCallback={success:function(a,b){var c=JSON.parse(a);1==c.status?(currentPage=$(".pagination").pagination("getCurrentPage"),getUserlist(currentPage),$(".popup-wrapper").hide()):showUserCreditPoup(c)},failure:function(a,b,c){}};$(document).ready(function(){getUserlist(1),$(document).on("click",".cross",function(){var a=$(this).data().id;removeUsers(a)}),$("#update-user-credits").on("click",function(a){a.preventDefault();var b=$(this).data("id"),c=$("#new-credits").val();$(this).data("name");$("#user-credit-form").valid()&&manageCredits(b,c)}),downloadOrderCSV("cms/export_users/","download-users-form"),downloadOrderCSV("cms/export_users_for_promotion/","download-users-promotion-form")});