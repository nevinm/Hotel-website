$(document).ready(function(){Ingredients.initView()});var Ingredients=function(){function a(){c(),b()}function b(){h("ingredient-image-upload-element"),i("")}function c(){$("#addNewIngredients").off().on("click",function(){d(),$(".popup-input-wrapper .ingredient-icon").attr("src",""),$("#newIngredient").val(""),$("#addIngredient").show(),$(".popup-input-wrapper .ingredient-icon").attr("data-id",""),l(),$("#editIngredient").hide(),$(".header").text("ADD NEW INGREDIENT"),$(".popup-wrapper").show(),$("#newIngredient").hasClass("error")&&$("form.popup-container").valid(),$("form").data("validator").resetForm()}),$("#no-button").off().on("click",function(a){a.preventDefault(),$(".confirm-popup-wrapper").removeAttr("style")}),$("#addIngredient").off().on("click",function(a){if(a.preventDefault(),$(".popup-container").valid()){$(".popup-wrapper").hide();var b=$("#newIngredient").val(),c=$(".popup-input-wrapper .ingredient-icon").attr("data-id");e(b,c)}}),$("#ingredientChangeIcon").off().on("click",function(){$(this).next(".ingredient-image-upload-element").trigger("click")}),$(".ingredient-image-upload-element").on("click",function(){var a=$(this),b=$(this).parent().find(".ingredient-icon");f(a,b)}),$("input[id^=editIngredientName-]").off().on("click",function(){var a=$(this).closest("tr").find(".ingredient-name").text(),b=$(this).data("url"),c=$(this).data("imageid");d(),$("#addIngredient").hide(),$("#editIngredient").show(),$(".header").text("EDIT INGREDIENT"),$("#newIngredient").val(a),$(".popup .ingredient-icon").attr("data-id",c),$(".popup-wrapper").show(),$("#newIngredient").hasClass("error")&&$("form.popup-container").valid(),$(".popup .ingredient-icon").attr("src",b),$("#editIngredient").attr("data-id",$(this).closest("tr").attr("data-id")),l()}),$("#editIngredient").off().on("click",function(a){if(a.preventDefault(),$(".popup-container").valid()){$(".popup-wrapper").hide();var b=$("#editIngredient").attr("data-id"),c=$("#newIngredient").val(),d=$(".popup-input-wrapper .ingredient-icon").attr("data-id");k(c,d,b)}}),$("input[id^=deleteIngredient-]").off().on("click",function(){$(".popup-wrapper").hide(),$(".confirm-popup-wrapper .header").text("Delete"),$(".confirm-popup-wrapper .content span").text("Are you sure you want to delete?");var a=$(this).closest("tr").attr("data-id");$("#yes-button").attr("data-id",a),$(".confirm-popup-wrapper").show()}),$("#yes-button").off().on("click",function(){var a=$(this).attr("data-id");$(".confirm-popup-wrapper").hide(),m(a)})}function d(){$("#close").removeClass("clear"),$(".popup-input-wrapper").show(),$(".callback-status").hide()}function e(a,b){var c=baseURL+"cms/add_ingredient/";header={"session-key":localStorage.session_key},params={ingredient:a,image_id:b},data=JSON.stringify(params);var d=new AjaxHttpSender;d.sendPost(c,header,data,Ingredients.addIngredientCallback)}function f(a,b){$(a).fileupload({add:function(a,b){var c=/^image\/(gif|jpe?g|png)$/i,d=[];return b.originalFiles[0].type&&!c.test(b.originalFiles[0].type)?(d.message="Not an accepted file type",g(),void showPopup(d)):b.originalFiles[0].size&&b.originalFiles[0].size>2e6?(d.message="Filesize is too big",g(),void showPopup(d)):void b.submit()},dataType:"json",headers:{"session-key":localStorage.session_key},formData:{example:"test"},start:function(a){$(".upload-gif").show()},done:function(a,c){$(".upload-gif").hide(),1==c.result.status?($(b).attr("src",c.result.thumbnail_url),$(b).attr("data-id",c.result.id),$(b).show()):(g(),showPopup(c.result))}})}function g(){$(".popup-input-wrapper").hide(),$("#addIngredient, #editIngredient").hide(),$(".callback-status").show(),$(".header").text("MESSAGE"),$("#close").addClass("clear")}function h(a){$("."+a).attr("data-url",baseURL+"cms/upload_image/")}function i(a,b){var c=baseURL+"cms/list_ingredients/",d={"session-key":localStorage.session_key},e={search:a};void 0!==b&&(e={search:a,nextPage:b});var f=JSON.stringify(e),g=new AjaxHttpSender;g.sendPost(c,d,f,Ingredients.getIngredientsListCallback)}function j(a){$("#ingredientsArea tbody tr").remove(),$.each(a.aaData,function(a,b){$("#ingredientsArea tbody").append("<tr class='row' data-id='"+b.id+"'><td class='ingredient-name mealtype-name-value'>"+b.name+"</td><td><input type='button' data-url='"+b.image_url+"' class='btn btn-small-primary medium-green' id='editIngredientName-"+b.image_id+"' data-imageid='"+b.image_id+"' value='EDIT'></td><td><input type='button' class='btn btn-small-primary medium-green' id='deleteIngredient-"+b.image_id+"' value='DELETE'></td><td><img class='mealtype-icon ingredient-icon' src='"+b.image_url+"'/><input class='ingredient-image-upload-element' value='' type='file' name='image_upload'/></td></tr>")}),c(),h("ingredient-image-upload-element")}function k(a,b,c){var d=baseURL+"cms/update_ingredient/"+c+"/";header={"session-key":localStorage.session_key},params={ingredient:a,image_id:b},data=JSON.stringify(params);var e=new AjaxHttpSender;e.sendPost(d,header,data,Ingredients.updateIngredientCallback)}function l(){""===$(".popup-input-wrapper .ingredient-icon").attr("data-id")?$(".popup-input-wrapper .ingredient-icon").hide():$(".popup-input-wrapper .ingredient-icon").show()}function m(a){var b=baseURL+"cms/delete_ingredient/"+a+"/";header={"session-key":localStorage.session_key},params={},data=JSON.stringify(params);var c=new AjaxHttpSender;c.sendPost(b,header,data,Ingredients.deleteIngredientCallback)}var n={success:function(a,b){var c=JSON.parse(a);-1==c.status?(g(),showPopup(c)):i("")},failure:function(a,b,c){}},o={success:function(a,b){var c=JSON.parse(a);1==c.status?j(c):(g(),showPopup(c))},failure:function(a,b,c){}},p={success:function(a,b){var c=JSON.parse(a);-1==c.status?(g(),showPopup(c)):i("")},failure:function(a,b,c){}},q={success:function(a,b){var c=JSON.parse(a);-1==c.status?(g(),showPopup(c)):i("")},failure:function(a,b,c){}};return{initView:a,addIngredientCallback:n,getIngredientsListCallback:o,updateIngredientCallback:p,deleteIngredientCallback:q}}();