function returnMealSearchParams(){var a=$("#searchBy-name").val(),b=$("#category option:selected").attr("value"),c=[];return $("#meal-type option:selected").each(function(){c.push($(this).attr("value"))}),$("#meal-list tr td").detach(),searchParams={search_name:a,category:b,mealtype:c}}function deleteMeal(a){var b=baseURL+"cms/delete_meal/"+a+"/";header={"session-key":localStorage.session_key},params={},data=JSON.stringify(params);var c=new AjaxHttpSender;c.sendPost(b,header,data,deleteMealCallback)}function getmealList(a,b,c,d){var e=baseURL+"cms/get_meals/";""==c&&(c.length=0),header={"session-key":localStorage.session_key},params={search:a,category_id:b,type_ids:c,nextPage:d},data=JSON.stringify(params);var f=new AjaxHttpSender;f.sendPost(e,header,data,getmealListCallback)}function getFilterContent(){var a=baseURL+"cms/get_categories_filters/";header={"session-key":localStorage.session_key},params={get:"1"},data=JSON.stringify(params);var b=new AjaxHttpSender;b.sendPost(a,header,data,getFilterContentCallback)}function populateFilterData(a){var b=a.meal_types,c=a.categories;$.each(b,function(a,b){$(".filter-container #meal-type").append('<option value="'+b.id+'">'+b.name+"</option")}),$.each(c,function(a,b){$(".filter-container #category").append("<option value='"+b.id+"'>"+b.name+"</option>")})}function updateMealOrder(a,b){var c=baseURL+"cms/update_meal_order/"+a+"/";header={"session-key":localStorage.session_key},params={order:b},data=JSON.stringify(params);var d=new AjaxHttpSender;d.sendPost(c,header,data,updateMealOrderCallback)}function updateAvailableMeals(a,b){var c=baseURL+"cms/update_meal_availablity/"+a+"/",d={"session-key":localStorage.session_key},e={available:b},f=JSON.stringify(e);(new AjaxHttpSender).sendPost(c,d,f,updateAvailableMealsCallback)}function updatePrimaryMeal(a,b){var c=baseURL+"cms/update_home_meal/";header={"session-key":localStorage.session_key},params={meal_id:a},data=JSON.stringify(params);var d=new AjaxHttpSender;d.sendPost(c,header,data,updatePrimaryMealOrderCallback,b)}function populateMealList(a){$("#meal-list tbody").empty();var b=a;$.each(b.aaData,function(a,b){if($("#meal-list tbody").append("<tr><td><img class='meal-list-img'src = '"+b.main_image+"'></td><td>"+b.name+"</td><td>"+b.description+"</td><td><span class = 'each-meal-order'>"+b.order+"</span><span  data-id = '"+b.id+"' class = 'edit-meal-order'>EDIT</span></td><td><span class = 'each-meal-available'>"+b.available+"</span><span  data-id = '"+b.id+"' class = 'edit-meal-available'>EDIT</span></td><td>"+b.category+"</td><td class='meal-type'></td><td>"+dollarConvert(parseFloat(b.price).toFixed(2))+"</td><td><a href='#!' data-id = '"+b.id+"' class='meal-homepage primary-meal'></a></td><td><a href='#' data-id = '"+b.id+"' class='' id='soldOut-"+b.id+"'>"+(1==b.sold_out?"YES":"NO")+"</a></td><td><button type='button' class='meal-delete btn btn-small-primary medium-green' data-id='"+b.id+"'>Delete</button></td><td><button type='button' class='meal-edit btn btn-small-primary medium-green' data-id='"+b.id+"'>Edit</button></td></tr>"),b.primary_meal?($(".meal-homepage:last").addClass("primary-meal"),$(".meal-homepage:last").text("YES")):($(".meal-homepage:last").addClass("non-primary-meal"),$(".meal-homepage:last").text("NO")),b.sold_out?$("#soldOut-"+b.id).removeClass("not-sold-out").addClass("sold-out"):$("#soldOut-"+b.id).removeClass("sold-out").addClass("not-sold-out"),b.meal_types.length){var c="";$.each(b.meal_types,function(a,b){c=c+b.name+", "}),$(".meal-type:last").text(c.trim().slice(0,-1))}else $(".meal-type:last").text("None");$("a[id^=soldOut-]").off().on("click",function(a){a.preventDefault(),updateSoldOut(this)})}),$(".pagination").pagination({pages:b.num_pages,currentPage:b.current_page,cssStyle:"light-theme",onPageClick:function(a,b){var c=returnMealSearchParams();getmealList(c.search_name,c.category,c.mealtype,a)},onInit:function(){if(getStringAfterHash(location.href,"#")){var a=getStringAfterHash(location.href,"#");-1!=a.indexOf("page")&&(pageNumber=getStringAfterHash(a,"-"),$(".pagination").pagination("getCurrentPage")==pageNumber||$(".pagination").pagination("selectPage",pageNumber))}}}),$(".non-primary-meal").on("click",function(){currentMealId=$(this).data("id"),updatePrimaryMeal(currentMealId,$(this))})}function updateSoldOut(a){var b=$(a).attr("data-id"),c=baseURL+"cms/update_meal_soldout/";header={"session-key":localStorage.session_key},params={meal_id:b,sold_out:"YES"===a.text?0:1},data=JSON.stringify(params);var d=new AjaxHttpSender;d.sendPost(c,header,data,updateSoldOutCallback,b)}$(document).ready(function(){$("#searchinMeal").on("click",function(){var a=returnMealSearchParams();getmealList(a.search_name,a.category,a.mealtype)}),$(document).on("click",".meal-edit",function(){mealId=$(this).data().id,window.location.href="create-meal.html?mealId="+mealId}),$(document).on("click",".meal-delete",function(){var a=confirm("Are you sure you want to delete this meal?");a&&(currentMealId=$(this).data().id,deleteMeal(currentMealId))}),$(document).on("click",".edit-meal-order",function(){var a=$(this).data().id,b=$(this).parent().find(".each-meal-order").text();$("#hidden-meal-id").val(a),$("#new-order").val(b),$(".edit-meal-order-popup").show(),$("form#change-meal-order-form").validate().resetForm()}),$("#change-order").on("click",function(a){a.preventDefault();var b=$("#new-order").val(),c=$("#hidden-meal-id").val();$("form#change-meal-order-form").valid()&&updateMealOrder(c,b)}),$(document).on("click",".edit-meal-available",function(){var a=$(this).data().id,b=$(this).parent().find(".each-meal-available").text();$("#hiddenMealId").val(a),$("#newAvailable").val(b),$(".edit-meal-available-popup").show(),$("form#changeAvailableForm").validate().resetForm()}),$("#updateAvailable").on("click",function(a){a.preventDefault();var b=$("#newAvailable").val(),c=$("#hiddenMealId").val();$("form#changeAvailableForm").valid()&&updateAvailableMeals(c,b)}),$("#cancel").on("click",function(){$(".edit-meal-order-popup").hide()}),$(".edit-meal-available-popup .cancel").on("click",function(){$(".edit-meal-available-popup").hide()}),getmealList("","","",0),getFilterContent()});var deleteMealCallback={success:function(a,b){var c=(JSON.parse(a),returnMealSearchParams());currentPage=$(".pagination").pagination("getCurrentPage"),getmealList(c.search_name,c.category,c.mealtype,currentPage)},failure:function(a,b,c){}},getmealListCallback={success:function(a,b){var c=JSON.parse(a);c.aaData.length>0?($(".meal-list-empty").hide(),populateMealList(c)):($(".meal-list-empty").show(),$(".pagination").pagination({pages:0,cssStyle:"light-theme"}))},failure:function(a,b,c){}},getFilterContentCallback={success:function(a,b){var c=JSON.parse(a);populateFilterData(c)},failure:function(a,b,c){}},updateMealOrderCallback={success:function(a,b){var c=JSON.parse(a);1==c.status?(currentPage=$(".pagination").pagination("getCurrentPage"),getmealList()):($("#viewPopup .content span").text(c.message),$("#viewPopup").show()),$(".edit-meal-order-popup").hide()},failure:function(a,b,c){}},updatePrimaryMealOrderCallback={success:function(a,b,c){var d=JSON.parse(a);1==d.status?($(".primary-meal").addClass("non-primary-meal"),$(".primary-meal").text("NO"),$(".primary-meal").removeClass("primary-meal"),$(c).removeClass("non-primary-meal"),$(c).addClass("primary-meal"),$(c).text("YES")):($("#viewPopup .content span").text(d.message),$("#viewPopup").show())},failure:function(a,b,c){}},updateAvailableMealsCallback={success:function(a,b){var c=JSON.parse(a);1==c.status?(currentPage=$(".pagination").pagination("getCurrentPage"),getmealList()):($("#viewPopup .content span").text(c.message),$("#viewPopup").show()),$(".edit-meal-available-popup").hide()},failure:function(a,b,c){}},updateSoldOutCallback={success:function(a,b,c){var d=JSON.parse(a);1==d.status?"YES"===$("#soldOut-"+c).text()?($("#soldOut-"+c).text("NO"),$("#soldOut-"+c).removeClass("sold-out").addClass("not-sold-out")):($("#soldOut-"+c).text("YES"),$("#soldOut-"+c).removeClass("not-sold-out").addClass("sold-out")):($(".popup-wrapper:first .content span").text(d.message),$(".popup-wrapper:first").show())},failure:function(a,b,c){}};