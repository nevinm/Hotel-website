function bindEnterSubmittion(){$(".tips-enter-submit").on("keydown",function(a){13==a.keyCode&&$("#add-tips-main").trigger("click")})}function addDynamicApiUrlUploadPicture(a){$("#"+a).attr("data-url",baseURL+"cms/upload_image/")}function addMainTipsTricks(a,b,c,d){$("#tips-and-tricks-table").append('<tr data-id="'+d+'"><td><span class="video-url">'+a+'</span></td><td><span class="video-heading">'+b+'</span><img class="add-tips-sublist" src="../../images/add-button-md.png"><img class="del-tips-sub-list" src = "../../images/del.png"><ul class="sub-tips-tricks"></ul></td></tr>'),c&&$.each(c,function(a,b){parentElement=$(".sub-tips-tricks:last").parent(),addSubTipsTricks(parentElement,b)})}function addSubTipsTricks(a,b){b?a.find("ul").append("<li>"+b+'<img class="remove" src="../../images/del.png"></li>'):($("#save-tips").unbind(),$("#save-tips").on("click",function(){var b=$("#tips_tricks_content").val();b.length&&(a.find("ul").append("<li>"+$("#tips_tricks_content").val()+'<img class="remove" src="../../images/del.png"></li>'),$(".tips-tricks-wrapper").hide())}))}function checkIfMealEdit(){return mealId=getParameterFromUrl("mealId"),mealId.length?(getMeals(mealId),createMealParams.edit_id=mealId,!0):!1}function extractNutrients(){var a=[];return $(".nutrient-main-container").map(function(){var b=$(this),c=$(b).find(".nutrient-main"),d=$(b).find(".nutrient-sub"),e=[];nutrientMainDetails=extractNutrientInnerDetails(c),$(b).find(".nutrient-sub").each(function(){var a=$(this),b=extractNutrientInnerDetails(d,a);e.push(b)}),oneNutrientTotal={mainNutrient:nutrientMainDetails.nutrientsName,perServing:nutrientMainDetails.servingValue,dailyValue:nutrientMainDetails.dailyValue,subNutrients:e},a.push(oneNutrientTotal)}),a}function extractNutrientInnerDetails(a,b){var c;c=b?b:a;var d=$(c).find(".nutrients-value").text(),e=$(c).find(".serving-value").text(),f=$(c).find(".daily-value").text();return{nutrientsName:d,servingValue:e,dailyValue:f}}function traverseTipsTricks(){return tipsAndTricksData=[],$("#tips-and-tricks-table tbody tr").map(function(){var a=$(this);a.each(function(){var a=extractTipsAndTricks(this);tipsAndTricksData.push(a)})}),tipsAndTricksData}function extractTipsAndTricks(a){var b=[],c=$(a).attr("data-id"),d=$(a).find(".video-url").text(),e=$(a).find(".video-heading").text();$(a).find("ul li").each(function(){b.push($(this).text())});var f={video_url:d,title:e,description:b};return"undefined"!=c&&(f.id=c),f}function uploadImage(a,b){$("#"+a).fileupload({add:function(a,b){var c=/^image\/(gif|jpe?g|png)$/i,d=[];return b.originalFiles[0].type&&!c.test(b.originalFiles[0].type)?(d.message="Please enter gif/jpg/png",void showPopup(d)):b.originalFiles[0].size&&b.originalFiles[0].size>2e6?(d.message="Filesize is too big",void showPopup(d)):void b.submit()},dataType:"json",headers:{"session-key":localStorage.session_key},formData:{example:"test"},done:function(a,c){$("#"+b).attr("src",c.result.thumbnail_url),$("#"+b).attr("data-id",c.result.id),$("#"+b).show()}})}function createMeal(){var a=$("#meal-name").val(),b=$("#meal-price").val(),c=$("#meal-tax").val(),d=$("#meal-calories").val(),e=$("#meal-prep-time").val(),f=$("#meal-saved-time").val(),g=$("#description").val(),h=$("#create-meal-available").val(),i=$("#create-meal-category option:selected").attr("value"),j=$("#meal-image").attr("data-id"),k=$("#kitchen-image").attr("data-id"),l=$("#chef-image").attr("data-id"),m=($("#ingredients-image").attr("data-id"),$("#chef-comments").val()),n=$("#chef-name").val(),o=$("#soldOut option:selected").attr("value");meal_sub=$("#meal-sub-name").val();var p=[],q="",r=[],s=[],t=[],u=[],v=nutrients=[];v.length=0,nutrients.length=0,v=traverseTipsTricks(),nutrients=getNutrients(),$(".ingredients-container .list-container ul").find("li").each(function(){q=$(this).text();var a=$(this).attr("id").split("list-")[1];void 0!==a&&p.push(a)}),$(".pre-requisties-container .list-container ul").find("li").each(function(){q=$(this).text(),r.push(q)}),$(".preperation-container-1 .list-container ul").find("li").each(function(){q=$(this).text(),t.push(q)}),$(".preperation-container-2 .list-container ul").find("li").each(function(){q=$(this).text(),u.push(q)}),$("#create-meal-mealType option:selected").each(function(){s.push($(this).attr("value"))});var w=baseURL+"cms/create_meal/";header={"session-key":localStorage.session_key},createMealFields={name:a,description:g,price:b,tax:c,calories:d,chef_image:l,chef_name:n,chef_comments:m,main_image:j,cat_id:i,filter_ids:s,available:h,ingredients:p,pre_requisites:r,pre_requisites_image:k,user_to_do:t,ingredients_image:"",preparation_time:e,finished_preparation:u,saved_time:f,tips:v,sub:meal_sub,nutrients:nutrients,sold_out:o},$.each(createMealFields,function(a,b){createMealEmptyCheck(a,b)}),data=JSON.stringify(createMealParams);var x=new AjaxHttpSender;x.sendPost(w,header,data,createMealCallback)}function createMealEmptyCheck(a,b){0!=b.length?createMealParams[a]=b:delete createMealParams[a]}function populateListData(a,b,c){if(c)$("."+b).find(".list-container ul").empty(),$.each(c,function(a,c){$("."+b).find(".list-container ul").append("<li>"+c+'<img class="remove" src="../../images/del.png"></li>')});else{var d=$("#"+a).val();$("#meal-prep-time").val(),$("#meal-saved-time").val();void 0!=d&&""!=d&&$("."+b).find(".list-container ul").append("<li>"+d+'<img class="remove" src="../../images/del.png"></li>')}}function getFilterContent(){var a=baseURL+"cms/get_categories_filters/";header={"session-key":localStorage.session_key},params={get:"1"},data=JSON.stringify(params);var b=new AjaxHttpSender;b.sendPost(a,header,data,getFilterContentCallback)}function populateCreateMealFilter(a,b){$.each(a,function(a,b){$("#create-meal-mealType ").append("<option value='"+b.id+"'>"+b.name+"</option>")}),$.each(b,function(a,b){$("#create-meal-category").append("<option value='"+b.id+"'>"+b.name+"</option>")}),checkIfMealEdit("mealFilter")}function populateNutrients(a,b,c,d){$(".nutrients-total").append("<div class='nutrient-main-container'><div class='nutrient-main'><div><span>Nutrients</span><span class='nutrients-value'>"+a+"</span></div><div><span>Per Serving</span><span class='serving-value'>"+b+"</span></div><div><span>Daily Value</span><span class='daily-value'>"+c+"</span></div><img class='add-nutrient-sublist' src='../../images/add-button-md.png'></div><img class='remove remove-main-nutrients remove-nutrients' src='../../images/cross-black.png'></div>"),d&&(parentElement=$(".nutrient-main-container:last"),$.each(d.subNutrients,function(a,b){populateSubNutrients(b.nutrientsName,b.servingValue,b.dailyValue,parentElement)}))}function populateSubNutrients(a,b,c,d){$(d).append("<div class='nutrient-sub'><div><span>Nutrients</span><span class='nutrients-value'>"+a+"</span></div><div><span>Per Serving</span><span class='serving-value'>"+b+"</span></div><div><span>Daily Value</span><span class='daily-value'>"+c+"</span></div><img class='remove remove-sub-nutrients remove-nutrients' src='../../images/cross-black.png'></div></div>"),$(".nutrients-popup-wrapper").hide()}function addSubNutrients(a){parentElement=$(a).parents().eq(1),$("#save-nutrients").unbind("click"),$("#save-nutrients").on("click",function(){var a=$("#sub-nutrients").val(),b=$("#sub-per-serving").val(),c=$("#sub-daily-value").val();populateSubNutrients(a,b,c,parentElement)})}function getMeals(a){var b=baseURL+"cms/get_meal_details/"+a+"/";header={"session-key":localStorage.session_key},params={},data=JSON.stringify(params);var c=new AjaxHttpSender;c.sendPost(b,header,data,getMealsContentCallback)}function populateMealDetails(a){$("#meal-name").val(a.name),$("#description").val(a.description),$("#chef-image").attr("src",a.chef_image.url),$("#chef-image").attr("data-id",a.chef_image.id),$("#meal-image").attr("src",a.main_image.url),$("#meal-image").attr("data-id",a.main_image.id),$("#meal-sub-name").val(a.sub),$("#meal-price").val(parseFloat(a.price).toFixed(2)),$("#meal-tax").val(parseFloat(a.tax_percentage)),$("#meal-calories").val(a.calories),$("#chef-name").val(a.chef_name),$("#chef-comments").val(a.chef_comments),$("#create-meal-available").val(a.available),$("#create-meal-category").val(a.cat_id.id),$.each(a.filters,function(a,b){$($("#create-meal-mealType option")[0]).attr("selected",!1),$("#create-meal-mealType option[value='"+b.id+"']").prop("selected",!0)}),$("#soldOut option").removeAttr("selected"),$("#soldOut option[value='"+a.sold_out+"']").prop("selected",!0),$("#meal-prep-time").val(a.preparation_time),$("#meal-saved-time").val(a.saved_time),populateListData("","preperation-container-1",a.user_to_do),populateListData("","preperation-container-2",a.finished_preparation),populateListData("","pre-requisties-container",a.pre_requisites),$("#kitchen-image").attr("src",a.pre_requisites_image.url),$(".nutrients-total").empty(),setNutrients(a.nutrients),$("#tips-and-tricks-table").find("tbody").empty(),$.each(a.tips,function(a,b){addMainTipsTricks(b.video_url,b.title,b.description,b.id)}),addIngredient(a.ingredients)}function ytVidId(a){var b=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return a.match(b)?!0:!1}function emptyvalidation(a){var b=/^[\s\t\r\n]*\S+/gi;return a.match(b)?!0:!1}function imgValidation(a){var b=/\.(jpeg|jpg|gif|png)$/.test(a);return b}function getAllIngredients(){var a=baseURL+"cms/list_ingredients/";header={"session-key":localStorage.session_key};var b={search:""};data=JSON.stringify(b);var c=new AjaxHttpSender;c.sendPost(a,header,data,ingredientsListCallback)}function populateIngredientsDropdown(a){$("#selectIngredients").html("<option value='0' selected>Select</option>"),$.each(a,function(a,b){$("#selectIngredients").append('<option value="'+b.id+'">'+b.name+"</option>")})}function addIngredient(a){var b=$("#selectIngredients :selected").text(),c=$("#selectIngredients :selected").val();$("#meal-prep-time").val(),$("#meal-saved-time").val();if(void 0!==a)$.each(a,function(a,b){0==$("#list-"+b.id).length&&($(".ingredients-container .list-container ul").append('<li id="list-'+b.id+'">'+b.name+'<img class="remove" src="../../images/del.png"></li>'),$(".ingredients-container").closest(".content-1").find(".img-container ul").append('<li id="for-list-'+b.id+'"><div><img src="'+b.image_url+'"><span>'+b.name+"</span></div></li>"))});else if("select"!==$("#selectIngredients :selected").text().toLowerCase()){var d=($(".ingredients-container .list-container ul li").length+1,ingredientsList[c]);void 0!=b&&""!=b&&0==$("#list-"+c).length&&($(".ingredients-container .list-container ul").append('<li id="list-'+c+'">'+b+'<img class="remove" src="../../images/del.png"></li>'),$(".ingredients-container").closest(".content-1").find(".img-container ul").append('<li id="for-list-'+c+'"><div><img src="'+d.image_url+'"><span>'+d.name+"</span></div></li>"))}$("li[id^=list-] .remove").off().on("click",function(a){removeIngredient(a)})}function removeIngredient(a){var b=$(a.target).parent().attr("id");$("#"+b).remove(),$("#for-"+b).remove()}function getNutrients(){function a(a,b){return console.log(a.find(b+" input").val()),void 0!==a.find(b+" input").val()&&a.find(b+" input").val().length>0?a.find(b+" input").val()+" "+a.find(b+" span").text().trim():""}var b=$("#nutritionSection table tbody tr"),c=new Array,d=new Object,e=new Array;return $.each(b,function(b,f){if($(f).hasClass("main-nutrient-tr"))$.isEmptyObject(d)||(d.subNutrients=e,c.push(d)),d=g={},e=[],d.mainNutrient=$(f).find("th").attr("data-attr"),d.perServing=a($(f),".per-serving-input"),d.dailyValue=a($(f),".daily-value-input");else if($(f).hasClass("sub-nutrient-tr")){var g={};g.nutrientsName=$(f).find("td").first().attr("data-attr"),g.servingValue=a($(f),".per-serving-input"),g.dailyValue=a($(f),".daily-value-input"),e.push(g)}}),$.isEmptyObject(d)||(d.subNutrients=e,c.push(d)),c}function setNutrients(a){function b(a){return a.indexOf(" ")>0?a.substring(0,a.lastIndexOf(" ")):$.isNumeric(a)?a:""}$.each($(".main-nutrient-tr"),function(c,d){$.each(a,function(a,c){return c.mainNutrient==$(d).find("th").attr("data-attr")?($(d).find(".daily-value-input input").val(b(c.dailyValue)),$(d).find(".per-serving-input input").val(b(c.perServing)),c.subNutrients.length>0&&$.each(c.subNutrients,function(a,c){$.each($(".sub-nutrient-tr"),function(a,d){return c.nutrientsName==$(d).find("td").first().attr("data-attr")?($(d).find(".daily-value-input input").val(b(c.dailyValue)),$(d).find(".per-serving-input input").val(b(c.servingValue)),!1):void 0})}),!1):void 0})})}var nutrient_sub_category=0,nutrient_main_category=0,tipsAndTricksData=[],createMealParams={},mealId,ingredientsList={};$(document).ready(function(){$("#create-meal-button").on("click",function(a){a.preventDefault();var b=$("#ingredientsContent .list-container li[id^=list-]");$("form#create-meal").valid()&&void 0!==b&&b.length>0&&createMeal(),void 0!==b&&0===b.length?($("#selectIngredients").addClass("error"),$("#selectIngredientsError").show()):($("#selectIngredients").removeClass("error"),$("#selectIngredientsError").hide())}),$("#selectIngredients").on("change",function(){$("#selectIngredientsError").attr("style","display:none !important;")}),$(".add-list-button,.add-preparation-button").on("click",function(){var a=$(this).prev().find(".create-meal-input").attr("id"),b=$(this).parent().attr("class");populateListData(a,b)}),$(".add-ingredients-list-button").off().on("click",function(){addIngredient()}),$(".add-nutrition-content").on("click",function(){var a=$("#nutrients").val(),b=$("#nutrients-per-serving").val(),c=$("#nutrients-daily-value").val();void 0!=a&&""!=a&&(populateNutrients(a,b,c),$("#nutrients").val(""),$("#nutrients-per-serving").val(""),$("#nutrients-daily-value").val(""))}),$(document).on("click",".add-nutrient-sublist",function(){$(".nutrients-popup-wrapper").show(),addSubNutrients(this)}),$("#cancel-nurient-popup").on("click",function(){$(".nutrients-popup-wrapper").hide()}),$(document).on("click",".remove",function(){$(this).parents().eq(0).remove()}),$("#add-tips-main").on("click",function(a){a.preventDefault();var b,c,d=$("#tips-video-url").val().trim(),e=$("#tips-and-tricks").val();b=ytVidId(d)||imgValidation(d),c=emptyvalidation(e),b&&c?(addMainTipsTricks(d,e),$("#tips-video-url,#tips-and-tricks").removeClass("error"),$("#tips-video-url-label-error,#tips-and-tricks-label-error").hide()):($("#tips-video-url,#tips-and-tricks").addClass("error"),$("#tips-video-url-label-error,#tips-and-tricks-label-error").show(),b&&($("#tips-video-url").removeClass("error"),$("#tips-video-url-label-error").hide()),c&&($("#tips-and-tricks").removeClass("error"),$("#tips-and-tricks-label-error").hide()))}),$(document).on("click",".add-tips-sublist",function(){$(".tips-tricks-wrapper").show();var a=$(this).parent();addSubTipsTricks(a)}),$(document).on("click",".del-tips-sub-list",function(){$(this).parents().eq(1).remove()}),$(document).on("click","#cancel-tips-popup",function(){$(".tips-tricks-wrapper").hide()}),$("#meal-image-input").on("click",function(){uploadImage("meal-image-input","meal-image")}),$("#chef-image-input").on("click",function(){uploadImage("chef-image-input","chef-image")}),$("#kitchen-image-input").on("click",function(){uploadImage("kitchen-image-input","kitchen-image")}),$("#ingredients-image-input").on("click",function(){uploadImage("ingredients-image-input","ingredients-image")}),$(".forminput-wrapper").on("keydown",function(a){if(13==a.keyCode){var b=$(this).parent().find("input[type=button][value=add]"),c=$(this).find("input").attr("id");b.length&&(a.preventDefault(),$(b).trigger("click"),"meal-saved-time"==c||"meal-prep-time"==c||$("#"+c).val(""))}}),$("#nutritionSection tbody input").on("input",function(a){var b=$(this).val();/^[0-9]{0,15}(\.[0-9]{0,2})?$/g.test($(this).val())||$(this).val(b.slice(0,b.length-1))}).on("keydown",function(a){var b=a.which?a.which:a.keyCode;return 190==b&&-1==$(this).val().indexOf(".")||110==b&&-1==$(this).val().indexOf(".")||!(48>b&&8!=b||b>57&&96>b||b>105)?/^[0-9]{0,15}(\.[0-9]{0,2})?$/g.test($(this).val())?!0:void 0:!1}),addDynamicApiUrlUploadPicture("meal-image-input"),addDynamicApiUrlUploadPicture("chef-image-input"),addDynamicApiUrlUploadPicture("kitchen-image-input"),addDynamicApiUrlUploadPicture("ingredients-image-input"),getFilterContent(),getAllIngredients()});var createMealCallback={success:function(a,b){var c=JSON.parse(a);showPopup(c),1==c.status&&(checkIfMealEdit()||$("#create-meal")[0].reset())},failure:function(a,b,c){}},getFilterContentCallback={success:function(a,b){var c=JSON.parse(a),d=c.meal_types,e=c.categories;populateCreateMealFilter(d,e)},failure:function(a,b,c){}},getMealsContentCallback={success:function(a,b){mealDetails=JSON.parse(a),populateMealDetails(mealDetails)},failure:function(a,b,c){}},ingredientsListCallback={success:function(a,b){var c=JSON.parse(a);1==c.status&&(ingredientsList=new Object,$.each(c.aaData,function(a,b){ingredientsList[b.id]=b}),populateIngredientsDropdown(ingredientsList))},failure:function(a,b,c){}};