$(document).ready(function(){DeliverySlots.initView()});var DeliverySlots=function(){function a(){b(),c()}function b(){d()}function c(){$('.week-section input[type="text"]').off().keyup(function(a){/\D/g.test(this.value)?this.value=this.value.replace(/\D/g,""):this.value>0?$(this).removeAttr("style"):0==this.value&&$(this).attr("style","color:#E86565;")}),$("#applySlots").off().on("click",function(a){a.preventDefault(),k()})}function d(){var a=baseURL+"cms/get_delivery_slots/",b={"session-key":localStorage.session_key},c=JSON.stringify(e()),d=new AjaxHttpSender;d.sendPost(a,b,c,DeliverySlots.getThisWeekCallback),c=JSON.stringify(e("next")),d.sendPost(a,b,c,DeliverySlots.getNextWeekCallback)}function e(a){var b=1,c=(new Date).getDay(),d=new Date((new Date).valueOf()-864e5*(0>=c?7-b:c-b)),e=f(d,6);m.dateWeek.thisStart=d,m.dateWeek.thisEnd=e,"next"===a&&(d=f(e,1),e=f(d,6),m.dateWeek.nextStart=d,m.dateWeek.nextEnd=e);var h=g(d,"MM-DD-YYYY"),i=g(e,"MM-DD-YYYY");return{from_date:h,to_date:i}}function f(a,b){return new Date(a.valueOf()+864e5*b)}function g(a,b){return"MM-DD-YYYY"===b?("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2)+"-"+a.getFullYear():"date"===b?new Date(a.replace(/(\d{2})-(\d{2})-(\d{4})/,"$1/$2/$3")):void 0}function h(a,b){var d=a.aaData,e=["SUN","MON","TUE","WED","THU","FRI","SAT"],h="",k=new Date,l=(new Date).setHours(0,0,0,0);$.each(d,function(a,b){k=g(b.date,"date"),h+=k.valueOf()==l?'<tr><th style="color:#8EC657;">'+e[k.getDay()]+" "+k.getDate()+"</th>":"<tr><th>"+e[k.getDay()]+" "+k.getDate()+"</th>",h+=k.valueOf()<l?'<td><input type="text" value="'+b.slot1+'" maxlength="3" disabled></td><td><input maxlength="3" type="text" value="'+b.slot2+'" disabled></td><td><input  maxlength="3" type="text" value="'+b.slot3+'" disabled></td><td><input  maxlength="3" type="text" value="'+b.slot4+'" disabled></td><td><input  maxlength="3" type="text" value="'+b.slot5+'" disabled></td></tr>':j(b.slot1)+j(b.slot2)+j(b.slot3)+j(b.slot4)+j(b.slot5)+"</tr>"}),h+=i(f(k,1),e),h+=i(f(k,2),e),$(b+" tbody").html(h),c()}function i(a,b){return'<tr class="holidays"><th>'+b[a.getDay()]+" "+a.getDate()+'</th><td><input  maxlength="3" type="text" disabled></td><td><input  maxlength="3" type="text" disabled></td><td><input maxlength="3" type="text" disabled></td><td><input maxlength="3" type="text" disabled></td><td><input type="text"  maxlength="3" disabled></td></tr>'}function j(a){return void 0!==a&&0===parseInt(a)?'<td><input type="text" value="'+a+'" style="color:#E86565;" maxlength="3"></td>':'<td><input type="text" value="'+a+'" maxlength="3"></td>'}function k(){var a=e(),b=e("next"),c={from_date:a.from_date,to_date:b.to_date,slots_list:new Array};c=l($("#thisWeek tbody tr:not(.holidays)"),c,m.dateWeek.thisStart),c=l($("#nextWeek tbody tr:not(.holidays)"),c,m.dateWeek.nextStart);var d=baseURL+"cms/manage_delivery_slots/",f={"session-key":localStorage.session_key},g=JSON.stringify(c),h=new AjaxHttpSender;h.sendPost(d,f,g,DeliverySlots.getApplySlotsCallback)}function l(a,b,c){return $.each(a,function(a,d){var e=$(d).find("td input[type=text]"),h={date:g(f(c,a),"MM-DD-YYYY"),slot1:""!==$(e[0]).val()?$(e[0]).val():0,slot2:""!==$(e[1]).val()?$(e[1]).val():0,slot3:""!==$(e[2]).val()?$(e[2]).val():0,slot4:""!==$(e[3]).val()?$(e[3]).val():0,slot5:""!==$(e[4]).val()?$(e[4]).val():0};b.slots_list.push(h)}),b}var m={dateWeek:{thisStart:"",thisEnd:"",nextStart:"",nextEnd:""}},n={success:function(a,b){var c=JSON.parse(a);1==c.status?h(c,"#thisWeek"):showPopup(c)},failure:function(a,b,c){}},o={success:function(a,b){var c=JSON.parse(a);1==c.status?h(c,"#nextWeek"):showPopup(c)},failure:function(a,b,c){}},p={success:function(a,b){var c=JSON.parse(a);1==c.status?(d(),c.message="Delivery slots are updated successfully.",showPopup(c)):showPopup(c)},failure:function(a,b,c){}};return{initView:a,getThisWeekCallback:n,getNextWeekCallback:o,getApplySlotsCallback:p}}();