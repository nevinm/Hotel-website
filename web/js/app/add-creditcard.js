function checkIfEdit(){var a=window.location.href;return-1!=a.indexOf("cardId")?(card_id=getParameterFromUrl("cardId"),savedCardDetails(card_id),$(".account-header h3").text("UPDATE CREDIT CARD"),$(".update-add-credit-card").val("UPDATE"),$(".content-heading").text("UPDATE CREDIT CARD"),$("form").attr("id","update-pay-form"),$("form").validate({ignore:".ignore"}),card_id):($("form").attr("id","pay-form"),$(".account-header h3").text("ADD A CREDIT CARD"),$(".update-add-credit-card").val("ADD"),$(".content-heading").text("ADD A CREDIT CARD"),void 0)}function populateYear(){for(var a=(new Date).getFullYear(),b=1;20>=b;b++)$("#ExpYear").append("<option value='"+a+"'>"+a+"</option>"),a+=1}function saveCreditCardDetails(a){var b=baseURL+"save_credit_card/",c={"session-key":localStorage.session_key},d={stripeToken:a};data=JSON.stringify(d);var e=new AjaxHttpSender;e.sendPost(b,c,data,saveCreditCardDetailsCallback)}function savedCardDetails(a){var b=baseURL+"get_saved_cards/",c={"session-key":localStorage.session_key},d={card_id:a};data=JSON.stringify(d);var e=new AjaxHttpSender;e.sendPost(b,c,data,savedCardDetailsCallback)}function populateCardDetails(a){var b=a.number,c=a.expire_year,d=a.expire_month;$("#card-number").val(b),$("#card-number").prop("readonly",!0),$("#card-number-error").hide(),$("#card-number").removeClass("error"),$("#card-number").addClass("button-disabled"),$("#cvv-number").addClass("button-disabled"),$("#cvv-number").val("****"),$("#cvv-number").prop("readonly",!0),$('#ExpMonth  option[value="'+d+'"]').prop("selected",!0),$('#ExpYear option[value="'+c+'"]').prop("selected",!0),$("#name-on-card").val(a.name?a.name:"")}function updateCardDetails(a){var b=baseURL+"update_credit_card/"+a+"/",c=$("#name-on-card").val(),d=$("#ExpMonth option:selected").val(),e=$("#ExpYear option:selected").text(),f={"session-key":localStorage.session_key},g={name:c,exp_month:d,exp_year:e};data=JSON.stringify(g);var h=new AjaxHttpSender;h.sendPost(b,f,data,updateCardDetailsCallback)}setTimeout(function(){$("form")[0].reset()},50),$(document).ready(function(){populateYear(),CartItemCount(),stripeIntegration();var a=checkIfEdit();$(".update-add-credit-card").on("click",function(b){b.preventDefault(),$("form").valid()&&("ADD"==$(".update-add-credit-card").val()&&$("form").submit(),"UPDATE"==$(".update-add-credit-card").val()&&updateCardDetails(a))})});var saveCreditCardDetailsCallback={success:function(a,b){var c=JSON.parse(a);1==c.status?($("form")[0].reset(),window.location.href="manage-creditcard.html"):showPopup(c)},failure:function(a,b,c){}},savedCardDetailsCallback={success:function(a,b){var c=JSON.parse(a);1==c.status?populateCardDetails(c.cards[0]):showPopup(c)},failure:function(a,b,c){}},updateCardDetailsCallback={success:function(a,b){var c=JSON.parse(a);1==c.status?window.location.href="manage-creditcard.html":showPopup(c)},failure:function(a,b,c){}};