var AddCreditCardController=function(){};AddCreditCardController.prototype=function(){var a=function(){var a=window.location.href;return-1!=a.indexOf("cardId")?(card_id=getParameterFromUrl("cardId"),e(card_id),$(".account-header h3").text("UPDATE CREDIT CARD"),$(".update-add-credit-card").val("UPDATE"),$(".content-heading").text("UPDATE CREDIT CARD"),$("form").attr("id","update-pay-form"),$("form").validate({ignore:".ignore"}),card_id):($("form").attr("id","pay-form"),$(".account-header h3").text("ADD A CREDIT CARD"),$(".update-add-credit-card").val("ADD"),$(".content-heading").text("ADD A CREDIT CARD"),void 0)},b=function(){for(var a=(new Date).getFullYear(),b=1;20>=b;b++)$("#ExpYear").append("<option value='"+a+"'>"+a+"</option>"),a+=1},c=function(a){var b=baseURL+"save_credit_card/",c={"session-key":localStorage.session_key},e={stripeToken:a};data=JSON.stringify(e);var f=new AjaxHttpSender;f.sendPost(b,c,data,d)},d={success:function(a,b){var c=JSON.parse(a);1==c.status?($("form")[0].reset(),window.location.href="manage-creditcard.html"):showPopup(c)},failure:function(a,b,c){}},e=function(a){var b=baseURL+"get_saved_cards/",c={"session-key":localStorage.session_key},d={card_id:a};data=JSON.stringify(d);var e=new AjaxHttpSender;e.sendPost(b,c,data,f)},f={success:function(a,b){var c=JSON.parse(a);1==c.status?g(c.cards[0]):showPopup(c)},failure:function(a,b,c){}},g=function(a){var b=a.number,c=a.expire_year,d=a.expire_month;$("#card-number").val(b),$("#card-number").prop("readonly",!0),$("#card-number-error").hide(),$("#card-number").removeClass("error"),$("#card-number").addClass("button-disabled"),$("#cvv-number").addClass("button-disabled"),$("#cvv-number").val("****"),$("#cvv-number").prop("readonly",!0),$('#ExpMonth  option[value="'+d+'"]').prop("selected",!0),$('#ExpYear option[value="'+c+'"]').prop("selected",!0),$("#name-on-card").val(a.name?a.name:"")},h=function(a){var b=baseURL+"update_credit_card/"+a+"/",c=$("#name-on-card").val(),d=$("#ExpMonth option:selected").val(),e=$("#ExpYear option:selected").text(),f={"session-key":localStorage.session_key},g={name:c,exp_month:d,exp_year:e},h=JSON.stringify(g),j=new AjaxHttpSender;j.sendPost(b,f,h,i)},i={success:function(a,b){var c=JSON.parse(a);1==c.status?window.location.href="manage-creditcard.html":showPopup(c)},failure:function(a,b,c){}};return{populateYear:b,checkIfEdit:a,updateCardDetails:h,saveCreditCardDetails:c}}(),$(document).ready(function(){var a=new AddCreditCardController;setTimeout(function(){$("form")[0].reset()},50),a.populateYear(),CartItemCount(),stripeIntegration();var b=a.checkIfEdit();$(".update-add-credit-card").on("click",function(c){c.preventDefault(),$("form").valid()&&("ADD"==$(".update-add-credit-card").val()&&$("form").submit(),"UPDATE"==$(".update-add-credit-card").val()&&a.updateCardDetails(b))})});