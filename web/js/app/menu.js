function infiniteScrolling(){console.log("infiniteScrolling");$(".subMenu").offset().top;$(document).unbind("scroll"),$(document).on("scroll",function(a){$(".listItems").length&&0==endOfList&&elementScrolling(".listItems:last")&&($(document).unbind("scroll"),mealData=JSON.parse(localStorage.meal_details),getmealList(mealData.search,mealData.category_id,mealData.type_ids,mealData.perPage,mealData.nextPage+1,!0))})}function getCategory(){var a=baseURL+"get_categories/",b={"session-key":localStorage.session_key},c={get:1},d=JSON.stringify(c),e=new AjaxHttpSender;e.sendPost(a,b,d,getCategoryCallback)}function getmealList(a,b,c,d,e,f){f&&$(".menu-loading-gif").show();var g=baseURL+"get_meals/";header={"session-key":localStorage.session_key},params={},data=JSON.stringify(params),localStorage.meal_details=data;var h=new AjaxHttpSender;h.sendPost(g,header,data,getmealListCallback,f)}function populateMealList(a,b){b||$(".listContainer").empty(),$.each(a.aaData,function(a,b){b.available&&$(".listContainer").append("<div class='listItems'><div class='meal-image-wrapper'><img src='"+b.main_image+"' data-id='"+b.id+"' class='thumbnail'><div class='meal-overlay' data-id='"+b.id+"'><p class='upper-line'><span>"+b.quantity+"</span> SERVINGS</p><p class='lower-line'>Added to cart</p></div> <div class='sold-overlay'  data-id='"+b.id+"'><p class='upper-line' style='top:44%;'>SOLD OUT</p></div></div><section class='listItemDetails'><h4 class='pullLeft menuItemName'>"+b.name+"</h4><div class='menuItemDetails'>"+b.sub+"</div><hr class='mealList-hr'></section><section class='listItemDetails tableDisplay'><input type='hidden' class='hidden-field' value='"+b.quantity+"'><h3 class='pullLeft itemCost'>"+dollarConvert(parseFloat(b.tax+b.price).toFixed(2))+"</h3><div class='serveBox'><span class='per-serving-text'>PER SERVING</span><span class='per-serving-box'>(2x SERVINGS PER BOX)</span></div><div class='removeItemButton' data-id='"+b.id+"'>&#8211</div><span id='addMenuButton'><a class='btn btn-small-primary medium-green addItemButton' data-id='"+b.id+"'>ADD</a></span></section></div>"),b.quantity<2?($('.removeItemButton[data-id="'+b.id+'"]').hide(),$('.meal-overlay[data-id="'+b.id+'"]').hide()):($('.removeItemButton[data-id="'+b.id+'"]').show(),$('.meal-overlay[data-id="'+b.id+'"]').show()),b.quantity>=10?$('.addItemButton[data-id="'+b.id+'"]').hide():$('.addItemButton[data-id="'+b.id+'"]').show(),0==b.sold_out?$(".sold-overlay:last").hide():($(".meal-overlay:last").hide(),$(".sold-overlay:last").show(),$(".removeItemButton:last").hide(),$(".addItemButton:last").addClass("button-disabled"))}),endOfList}function elementScrolling(a){var b=$(window).scrollTop(),c=b+$(window).height(),d=$(a).offset().top,e=d+$(a).height();return c>=e&&d>=b}function addToCart(a,b){var c=baseURL+"add_to_cart/",d={"session-key":localStorage.session_key},e={meal_id:a,quantity:b};data=JSON.stringify(e);var f=new AjaxHttpSender;f.sendPost(c,d,data,addToCartCallback,a)}$(document).ready(function(){window.onbeforeunload=function(a){0===cartCount&&cartCount<parseInt($(".count").text())&&SessionController.fbTrackConversionEvent(SessionController.getAddToCartPixel(),"0.00","USD")},$("#page-container").css("min-height",$(window).height()-200+"px");var a=6,b=1,c=[],d=767;"true"==localStorage.loggedIn?$(".menu-offer").show():($(".menu-offer").hide(),$("#header").css("margin-top","0px"),$(window).width()<=767&&$(window).width()>=320?$("#page-container").css("margin-top","75px"):$("#page-container").css("margin-top","100px")),$(document).on("click",".subMenu .menu-categories-list",function(){$(document).find(".subMenu ul li").removeClass("activeOption"),$(this).addClass("activeOption"),window.innerWidth<d&&$(".category-menu").slideToggle()}),$(document).on("click",".addItemButton",function(a){a.preventDefault();var b=0,c=$(this).attr("data-id");b=parseInt($(this).closest(".listItemDetails").find(".hidden-field").val())+2,10>=b&&($(this).closest(".listItemDetails").find(".hidden-field").val(b),"true"==localStorage.loggedIn?addToCart(c):("false"==localStorage.loggedIn||null===localStorage.getItem("loggedIn"))&&addToCart(c))}),$(document).on("click",".removeItemButton",function(a){var b=-2,c=0,d=$(this).attr("data-id");c=parseInt($(this).closest(".listItemDetails").find(".hidden-field").val())-2,c>=0&&($(this).closest(".listItemDetails").find(".hidden-field").val(c),addToCart(d,b))}),$(document).on("click",".thumbnail,.meal-overlay,.sold-overlay",function(){mealId=this.dataset.id,window.location.href="meal-details.html?mealId="+mealId}),$(document).on("click",".menu-categories-list",function(){b=1,categoryId=$(this).find("a").data().id,getmealList("",categoryId,c,a,1),infiniteScrolling()}),$(".category-header").on("click",function(){$(".category-menu").slideToggle()}),$(".filter-container").on("click",function(a){filterContainer=document.getElementsByClassName("filter-container")[0],filterCenter=document.getElementsByClassName("filter-center")[0],filterMenuLabel=document.getElementsByClassName("filter-menu-label")[0],arrowDown=document.getElementsByClassName("arrow-down")[1],subMenuFilter=document.getElementsByClassName("subMenuFilter")[0],(a.target==filterContainer||a.target==filterCenter||a.target==filterMenuLabel||a.target==arrowDown||a.target==subMenuFilter)&&$(".filter-drop-down").slideToggle()}),$(document).on("change",".filter-drop-down input[type=checkbox]",function(d){currentCategory=$(".activeOption a").attr("data-id"),b=1,$(this).is(":checked")?(c.push(parseInt($(this).val())),getmealList("",currentCategory,c,a,1)):(index=c.indexOf(parseInt($(this).val())),index>-1&&c.splice(index,1),getmealList("",currentCategory,c,a,1)),infiniteScrolling()}),$(window).on("scroll",function(a){var b=100,c=$(".subMenu"),d=$(document).scrollTop();d>=b?c.addClass("fixedMenu"):c.removeClass("fixedMenu")}),$("#share-now").on("click",function(){window.location.href="share-page.html"}),CartItemCount(setCartCount),getCategory(),getmealList("","","","","")});var getCategoryCallback={success:function(a,b){userDetails=JSON.parse(a),1==userDetails.status?($.each(userDetails.categories,function(a,b){$(".category-wrapper .category-menu").append("<li class='menu-categories-list'><a ' class='menu-categories' data-id='"+b.id+"'>"+b.name+"</a></li>")}),$.each(userDetails.meal_types,function(a,b){$(".filter-drop-down ul").append("<li><div><input id='mealtype"+a+"' type='checkbox' name='mealtype"+a+"' value='"+b.id+"'><label for='mealtype"+a+"'>"+b.name+"</label></div></li>")})):console.log("somthing wrong with categories")},failure:function(a,b,c){}},getmealListCallback={success:function(a,b,c){var d=JSON.parse(a);1==d.status?(endOfList=d.current_page==d.page_range[d.page_range.length-1],1==endOfList,populateMealList(d,c)):console.log("Something wrong with meals list"),$(".menu-loading-gif").hide()},failure:function(a,b,c){}},addToCartCallback={success:function(a,b,c){var d=JSON.parse(a),e=d.status;if(-1==e)showPopup(d);else{var f=$('a[data-id="'+c+'"]').closest(".listItems").find(".removeItemButton"),g=$('a[data-id="'+c+'"]').closest(".listItems").find(".addItemButton"),h=$('.meal-overlay[data-id="'+c+'"]');h.find(".upper-line span").text(d.quantity),0==d.quantity?(f.hide(),h.hide()):(f.fadeIn(),h.show()),d.quantity>=10?(g.hide(),h.find(".upper-line span").text(10)):g.show(),d.session_key&&d.session_key.length&&(localStorage.session_key=d.session_key,createCookie("SessionExpireTime","true",sessionExpiryTime)),CartItemCount()}},failure:function(a,b,c){}};