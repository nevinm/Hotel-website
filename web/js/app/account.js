function profileAutoPopulate(){var a=$("title").text();userDetails=JSON.parse(localStorage.user_profile),"Meisterdish - Change Contact"==a&&($("#change-contact input[name='firstname']").val(userDetails.first_name),$("#change-contact input[name='lastname']").val(userDetails.last_name),$("#change-contact input[name='phonenumber']").val(userDetails.mobile),$("input[name=notification]").prop("checked",userDetails.sms_notification)),"Meisterdish -Change Email"==a&&($(".current-email-container span").text(userDetails.email),$("input[name=notification]").prop("checked",userDetails.email_promotions),$("#hidden-email-promotion").val(userDetails.email_promotions)),"Meisterdish - Account"==a&&$(".small-profile-pic").attr("src",userDetails.profile_image_thumb)}function showAdminLink(){"true"==localStorage.admin_loggedIn?$(".admin-button").show():$(".admin-button").hide()}function getProfile(a){var b=baseURL+"get_profile/",c={"session-key":localStorage.session_key},d={get:1};data=JSON.stringify(d);var e=new AjaxHttpSender;e.sendPost(b,c,data,getProfileCallback,a)}function changeEmail(){var a=baseURL+"change_email/",b=$("#change-email").find("input[name=email]").val();isEmailPromotion=0,$("input[name=notification]").prop("checked")&&(isEmailPromotion=1),header={"session-key":localStorage.session_key},userData={email:b,email_promotion:isEmailPromotion},data=JSON.stringify(userData);var c=new AjaxHttpSender;c.sendPost(a,header,data,changeEmailCallback)}var userDetails,getProfileCallback={success:function(a,b,c){var d=JSON.parse(a);1==d.status?(localStorage.user_profile=a,$(".account-credit").text("$"+parseFloat(d.credits).toFixed(2)),profileAutoPopulate(),c&&("Not Available"!=d.profile_image_thumb?$("#"+c).attr("src",d.profile_image_thumb):$("#"+c).attr("src","../images/blank-person.png"))):showPopup(d)},failure:function(a,b,c){}};$(document).ready(function(){function a(){var a=baseURL+"edit_profile/",b=$("#change-contact"),d=b.find("input[name=firstname]").val(),e=b.find("input[name=lastname]").val(),f=b.find("input[name=phonenumber]").val(),g=0;$("input[name=notification]").prop("checked")&&(g=1),header={"session-key":localStorage.session_key},userData={first_name:d,last_name:e,mobile:f,sms_notification:g},data=JSON.stringify(userData);var h=new AjaxHttpSender;h.sendPost(a,header,data,c)}function b(){var a=$("#old-password").val(),b=$("#new-password").val(),c=($("#confirm-password").val(),{"session-key":localStorage.session_key}),e=baseURL+"change_password/",f={old_password:a,new_password:b},g=JSON.stringify(f),h=new AjaxHttpSender;h.sendPost(e,c,g,d)}var c={success:function(a,b){userDetails=JSON.parse(a),1==userDetails.status?(showPopup(userDetails),newName=$("#change-contact").find("input[name=firstname]").val(),$("#navbar-username a").text(newName),localStorage.username=newName):showPopup(userDetails)},failure:function(a,b,c){}};$("#change-contact #updateButton").on("click",function(b){b.preventDefault(),$("form#change-contact").valid()&&a()});var d={success:function(a,b){userDetails=JSON.parse(a),showPopup(userDetails),$("#change-password")[0].reset()},failure:function(a,b,c){}};$("#updatepassword").on("click",function(a){a.preventDefault(),$("form").valid()&&b()}),getProfile(),CartItemCount(),showAdminLink()});var changeEmailCallback={success:function(a,b){userDetails=JSON.parse(a),showPopup(userDetails),1==userDetails.status&&($("#change-email")[0].reset(),$("input[name=notification]").prop("checked",userDetails.email_promotion),$("#hidden-email-promotion").val(userDetails.email_promotion))},failure:function(a,b,c){}};$("input[name=notification]").on("click",function(){$("#change-email").validate().resetForm()}),$("#update-email").on("click",function(a){a.preventDefault();var b=JSON.parse($("#hidden-email-promotion").val());$("input[name=notification]").prop("checked")==b?$("form").valid()&&changeEmail():""==$("#change-email").find("input[name=email]").val()&&""==$("#change-email").find("input[name=confirmEmail]").val()?changeEmail():$("form").valid()&&changeEmail()});
