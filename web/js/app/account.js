var userDetails,AccountController=function(){};AccountController.prototype=function(){var a=function(){var a=$("title").text();userDetails=JSON.parse(localStorage.user_profile),"Meisterdish - Change Contact"==a&&($("#change-contact input[name='firstname']").val(userDetails.first_name),$("#change-contact input[name='lastname']").val(userDetails.last_name),$("#change-contact input[name='phonenumber']").val(userDetails.mobile),$("input[name=notification]").prop("checked",userDetails.sms_notification)),"Meisterdish -Change Email"==a&&($(".current-email-container span").text(userDetails.email),$("input[name=notification]").prop("checked",userDetails.email_promotions),$("#hidden-email-promotion").val(userDetails.email_promotions)),"Meisterdish - Account"==a&&$(".small-profile-pic").attr("src",userDetails.profile_image_thumb)},b=function(){"true"==localStorage.admin_loggedIn?$(".admin-button").show():$(".admin-button").hide()},c=function(a){var b=baseURL+"get_profile/",c={"session-key":localStorage.session_key},e={get:1};data=JSON.stringify(e);var f=new AjaxHttpSender;f.sendPost(b,c,data,d,a)},d={success:function(b,c,d){var e=JSON.parse(b);1==e.status?(localStorage.user_profile=b,$(".account-credit").text("$"+parseFloat(e.credits).toFixed(2)),a(),d&&("Not Available"!=e.profile_image_thumb?$("#"+d).attr("src",e.profile_image_thumb):$("#"+d).attr("src","../images/blank-person.png"))):showPopup(e)},failure:function(a,b,c){}},e=function(){var a=baseURL+"edit_profile/",b=$("#change-contact"),c=b.find("input[name=firstname]").val(),d=b.find("input[name=lastname]").val(),e=b.find("input[name=phonenumber]").val(),g=0;$("input[name=notification]").prop("checked")&&(g=1),header={"session-key":localStorage.session_key},userData={first_name:c,last_name:d,mobile:e,sms_notification:g},data=JSON.stringify(userData);var h=new AjaxHttpSender;h.sendPost(a,header,data,f)},f={success:function(a,b){userDetails=JSON.parse(a),1==userDetails.status?(showPopup(userDetails),newName=$("#change-contact").find("input[name=firstname]").val(),$("#navbar-username a").text(newName),localStorage.username=newName):showPopup(userDetails)},failure:function(a,b,c){}},g=function(){var a=$("#old-password").val(),b=$("#new-password").val(),c=($("#confirm-password").val(),{"session-key":localStorage.session_key}),d=baseURL+"change_password/",e={old_password:a,new_password:b},f=JSON.stringify(e),g=new AjaxHttpSender;g.sendPost(d,c,f,h)},h={success:function(a,b){userDetails=JSON.parse(a),showPopup(userDetails),$("#change-password")[0].reset()},failure:function(a,b,c){}},i=function(){var a=baseURL+"change_email/",b=$("#change-email").find("input[name=email]").val();isEmailPromotion=0,$("input[name=notification]").prop("checked")&&(isEmailPromotion=1),header={"session-key":localStorage.session_key},userData={email:b,email_promotion:isEmailPromotion},data=JSON.stringify(userData);var c=new AjaxHttpSender;c.sendPost(a,header,data,j)},j={success:function(a,b){userDetails=JSON.parse(a),showPopup(userDetails),1==userDetails.status&&($("#change-email")[0].reset(),$("input[name=notification]").prop("checked",userDetails.email_promotion),$("#hidden-email-promotion").val(userDetails.email_promotion))},failure:function(a,b,c){}};return{editContact:e,changePassword:g,changeEmail:i,getProfile:c,showAdminLink:b}}(),$(document).ready(function(){var a=new AccountController;$("#change-contact #updateButton").on("click",function(b){b.preventDefault(),$("form#change-contact").valid()&&a.editContact()}),$("#updatepassword").on("click",function(b){b.preventDefault(),$("form").valid()&&a.changePassword()}),$("input[name=notification]").on("click",function(){$("#change-email").validate().resetForm()}),$("#update-email").on("click",function(b){b.preventDefault();var c=JSON.parse($("#hidden-email-promotion").val());$("input[name=notification]").prop("checked")==c?$("form").valid()&&a.changeEmail():""==$("#change-email").find("input[name=email]").val()&&""==$("#change-email").find("input[name=confirmEmail]").val()?a.changeEmail():$("form").valid()&&a.changeEmail()}),a.getProfile(),CartItemCount(),a.showAdminLink()});