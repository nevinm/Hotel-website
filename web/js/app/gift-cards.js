function placeGiftOrder(){if("false"==localStorage.loggedIn&&$("#address").valid()&&$("#address").submit(),$(".saved-cards").is(":empty"))$("#pay-form").valid()&&$("#pay-form").submit();else{var a=$(".saved-cards .added-card:checked").attr("id");fetchGiftCardData("",a)}}function validateGiftOrder(){var a={};return $(".saved-card-list").length&&!$(".payment-checked:checked").length?(a.message="Add a method of payment and then proceed",showPopup(a),!1):!0}function redeemGiftCard(a){var b=baseURL+"redeem_gift_card/",c={"session-key":localStorage.session_key},d={code:a},e=JSON.stringify(d),f=new AjaxHttpSender;f.sendPost(b,c,e,redeemGiftCardCallback)}function getGiftCardData(){var a=$(".giftcard-selected"),b=a.length?$(a).find(".giftcard-amount").data("amount"):$("#giftcard-custom-amount").val(),c=$("#recipient-name").val(),d=$("#recipient-email").val(),e=$("#recipient-message").val(),f={};f={giftcardAmount:b,recipientName:c,recipientEmail:d,recipientMessage:e},localStorage.giftcardDetails=JSON.stringify(f)}function fetchLocalGiftCardData(){return JSON.parse(localStorage.giftcardDetails)}function populateGiftcardDetails(a){$(".recepient-name").text(a.recipientName),$(".recepient-email").text(a.recipientEmail),$(".recepient-message").text(a.recipientMessage),$(".recepient-amount").text("$"+parseFloat(a.giftcardAmount).toFixed(2)),$(".recepient-amount").attr("data-amount",a.giftcardAmount)}function fetchGiftCardData(a,b){var c=fetchLocalGiftCardData(),d={name:c.recipientName,email:c.recipientEmail,message:c.recipientMessage,amount:c.giftcardAmount,stripeToken:a,card_id:b};if("false"==localStorage.loggedIn){var e=$('input[name="firstname"]').val(),f=$('input[name="lastname"]').val(),g=$('input[name="email"]').val(),h=$('input[name="zip"]').val();guestParams={guest_first_name:e,guest_last_name:f,guest_email:g,guest_zip:h},$.extend(d,guestParams)}saveCreditCardGiftCard(d)}function saveCreditCardGiftCard(a){var b=baseURL+"gift_card_order/",c={"session-key":localStorage.session_key},d=a;data=JSON.stringify(d);var e=new AjaxHttpSender;e.sendPost(b,c,data,saveCreditCardGiftCardCallback),$(".loading-indicator").show()}function populateEditCardDetails(){$("#recipient-name").val($(".recepient-name").text()),$("#recipient-email").val($(".recepient-email").text()),$("#recipient-message").val($(".recepient-message").text()),$("#recipient-amount").val($($(".recepient-amount")[0]).data("amount"))}function updateRecipientGiftCard(){var a=$("#recipient-name").val(),b=$("#recipient-email").val(),c=$("#recipient-message").val(),d=$("#recipient-amount").val();if(e={},e={giftcardAmount:d,recipientName:a,recipientEmail:b,recipientMessage:c},localStorage.giftcardDetails=JSON.stringify(e),null!==localStorage.getItem("giftcardDetails")&&$(".giftcard-payment").length){var e=fetchLocalGiftCardData();populateGiftcardDetails(e)}$(".giftcard-popup-wrapper").hide()}function populateYear(){for(var a=(new Date).getFullYear(),b=1;20>=b;b++)$("#ExpYear").append("<option value='"+a+"'>"+a+"</option>"),a+=1}function savedCardDetails(){var a=baseURL+"get_saved_cards/",b={"session-key":localStorage.session_key},c={};data=JSON.stringify(c);var d=new AjaxHttpSender;d.sendPost(a,b,data,savedCardDetailsCallback)}function populateCardDetails(a,b){b?$.each(a,function(c,d){last_num=a[c].number.slice(-4),b==d.id&&$(".saved-cards").append("<div class='saved-card-list'><input type='radio' class='added-card pullLeft payment-checked' name='saved-card' id='"+d.id+"' class='radio-button-payment'><label for='"+d.id+"'><img class='paypal' src='"+d.logo+"'><span class='body-text-small'>"+d.type+" ending in "+last_num+"</span><span class='body-text-small'>Expires on "+d.expire_month+"/"+d.expire_year+"</span></label></div>")}):(last_num=a[0].number.slice(-4),$(".saved-cards").append("<div class='saved-card-list'><input type='radio' class='added-card pullLeft payment-checked' name='saved-card' id='"+a[0].id+"' class='radio-button-payment'><label for='"+a[0].id+"'><img class='paypal' src='"+a[0].logo+"'><span class='body-text-small'>"+a[0].type+" ending in "+last_num+"</span><span class='body-text-small'>Expires on "+a[0].expire_month+"/"+a[0].expire_year+"</span></label></div>"))}function populateCardDetailsInPopup(){var a=cardDetails.cards;$(".address-payment-list-popup .button").remove(),$(".address-payment-list-popup .popup-container").empty(),$(".address-payment-list-popup .popup-container").append("<div class='popup-sub-wrapper'></div>"),$.each(a,function(a,b){$(".address-payment-list-popup .popup-container .popup-sub-wrapper").append("<div class='payment-popup-sub-container'><input type='radio' class='added-card pullLeft' name='change-card' class='radio-button-payment' id='"+b.id+"'><label><img class='paypal' src='"+b.logo+"'><span class='body-text-small'>"+b.type+" ending in "+last_num+"</span><span class='body-text-small'>Expires on "+b.expire_month+"/"+b.expire_year+"</span></label></div>")}),$(".address-payment-list-popup .popup-container").append("<div class='button'><a href='#' class='btn btn-medium-primary medium-green pullLeft' id='save-payment'>SELECT</a><a href='#!' class='btn btn-medium-secondary' id='cancel'>CANCEL</a></div>"),$("#save-payment").addClass("button-disabled"),$(".address-payment-list-popup").show(),$("input[type=radio][name=change-card]").on("focus",function(){$("#save-payment").removeClass("button-disabled")})}function showSelectedPaymentMethod(a){$(".saved-cards").empty(),populateCardDetails(cardDetails.cards,a)}$(document).ready(function(){if(CartItemCount(),currentPage=getCurrentPage("/",".html",window.location.href),$("#giftcard-custom-amount").val("50"),"giftcard-payment"==currentPage&&stripeIntegration(),null!==localStorage.getItem("giftcardDetails")&&$(".giftcard-payment").length){var a=fetchLocalGiftCardData();populateGiftcardDetails(a)}"false"==localStorage.loggedIn&&$(".backToAccount").hide(),populateYear(),$("#redeem-card").on("click",function(){var a=$(".card-code").val();redeemGiftCard(a)}),localStorage.session_key?(savedCardDetails(),$(".payment-amount-container").addClass("center-align")):($(".payment-method").hide(),$(".payment-container-guest,.your-info-container,.payment-info-container").show(),$(".payment-amount-container").removeClass("center-align")),$(".giftcard-selector").on("click",function(){var a=0;$(".giftcard-selector").removeClass("giftcard-selected"),$(this).addClass("giftcard-selected"),$(".checkbox-image").attr("src","../images/unchecked.png"),$(this).find(".checkbox-image").attr("src","../images/checked.png"),$("#giftcard-custom-amount").val(""),a=$(this).find(".giftcard-amount").attr("data-amount"),$("#giftcard-custom-amount").val(a),$("#giftcard-form").validate().resetForm()}),$(".gift-amount a").on("click",function(a){a.preventDefault();var b=0;$(".gift-amount").removeClass("active-card"),$(this).closest(".gift-amount").addClass("active-card"),$("#giftcard-custom-amount").val(""),b=$(this).attr("data-amount"),$("#giftcard-custom-amount").val(b),$("#giftcard-form").validate().resetForm()}),$(".giftcard-custom-amount input").on("focus",function(a){a.preventDefault(),$(".active-card").length&&$(this).val(""),$(".gift-amount").removeClass("active-card")}),$("#edit-giftcard").on("click",function(){$(".giftcard-popup-wrapper").show(),populateEditCardDetails()}),$("#cancel").on("click",function(){$(".giftcard-popup-wrapper").hide()}),$("#edit-recipient-details").on("submit",function(a){a.preventDefault(),updateRecipientGiftCard()}),$(".proceed-checkout").on("click",function(a){a.preventDefault(),$("form").valid()&&(getGiftCardData(),window.location.href="giftcard-payment.html")}),$("#change-payment").on("click",function(){$(".address-payment-list-popup").show(),populateCardDetailsInPopup()}),$(document).on("click","#cancel",function(){$(".address-payment-list-popup").hide()}),$(document).on("click","#save-payment",function(){var a=$("input[type=radio][name=change-card]:checked").attr("id");showSelectedPaymentMethod(a),$(".address-payment-list-popup").hide()}),$("#address").on("submit",function(a){return a.preventDefault(),!1}),$("#gift-place-order").on("click",function(a){a.preventDefault(),validateGiftOrder()&&placeGiftOrder()})});var redeemGiftCardCallback={success:function(a,b){userDetails=JSON.parse(a),showPopup(userDetails),1==userDetails.status?$(".card-code").val(""):showPopup(userDetails)},failure:function(a,b,c){}},cardDetails,saveCreditCardGiftCardCallback={success:function(a,b){$(".loading-indicator").hide();var c=JSON.parse(a);1==c.status?($("#pay-form")[0].reset(),$("#close").addClass("redirectApproved"),showPopup(c)):showPopup(c)},failure:function(a,b,c){$(".loading-indicator").hide()}},savedCardDetailsCallback={success:function(a,b){cardDetails=JSON.parse(a),1==cardDetails.status?0!=cardDetails.cards.length?($(".payment-method").show(),$(".payment-info-container").hide(),populateCardDetails(cardDetails.cards)):($(".your-info-container").hide(),$(".payment-amount-container").addClass("center-align"),$(".gift-card-details-container,.payment-container-guest").addClass("halfWidth"),$(".payment-info-container,.details").addClass("fullWidth"),$(".payment-info-container").show(),$(".payment-info-container").css("padding-top","45px")):showPopup(cardDetails)},failure:function(a,b,c){}};