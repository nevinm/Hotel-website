function statusChangeCallback(a){"connected"===a.status?testAPI():"not_authorized"===a.status?(fbLogin(),document.getElementById("status").innerHTML="Please log into this app."):fbLogin()}function checkLoginState(){fbLogin()}function loginFB(a,b){var c=baseURL+"login/",d={},e={username:b,fb_id:a,remember:1},f=JSON.stringify(e),g=new AjaxHttpSender;g.sendPost(c,d,f,loginFBCallback)}function testAPI(){FB.api("/me",function(a){" Log in"==$("title").text().split("-")[1]?loginFB(a.id,a.email):(localStorage["fb-id"]=JSON.stringify(a.id),$("#signup-firstname").val(a.first_name),$("#signup-lastname").val(a.last_name),$("#signup-email").val(a.email))}),FB.api("/me/picture?width=300&height=300",function(a){a&&!a.error&&(localStorage["fb-image"]=a.data.url)})}function fbLogin(){FB.login(function(a){if(a.authResponse){var b=window.location.href;currentPage=getCurrentPage("/",".html",b),"share-page"==currentPage&&facebookShare(homeUrl,a.authResponse.accessToken),localStorage["fb-access_token"]=a.authResponse.accessToken,testAPI()}else console.log("User cancelled login or did not fully authorize.")},{scope:"publish_stream,email,publish_actions"})}var isLoaded=!1;window.fbAsyncInit=function(){FB.init({appId:GLOBAL.APP_ID,cookie:!0,oauth:!0,status:!0,xfbml:!0,version:"v2.3"}),isLoaded=!0};var loginFBCallback={success:function(a,b){if(userDetails=JSON.parse(a),-1==userDetails.status)showPopup(userDetails);else{var c=userDetails.user.first_name;localStorage.username=c,null===localStorage.getItem("session_key")&&(localStorage.session_key=userDetails.session_key),localStorage.loggedIn=!0,createCookie("SessionExpireTime","true",sessionExpiryTime),checkLoggedIn(),window.location.href="../index.html"}},failure:function(a,b,c){}};!function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk");