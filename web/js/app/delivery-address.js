var DeliveryAddressController=function(){};DeliveryAddressController.prototype=function(){var a={success:function(a,b){var c=JSON.parse(a);1==c.status?(d(),n()):showErrorPopup(c)},failure:function(a,b,c){}},b=function(b){var c=baseURL+"remove_address/",d={"session-key":localStorage.session_key},e={id:b};data=JSON.stringify(e);var f=new AjaxHttpSender;f.sendPost(c,d,data,a)},c={success:function(a,b){var c=JSON.parse(a);1==c.status?(localStorage.delivery_addressess=a,e(c),n()):showErrorPopup(c)},failure:function(a,b,c){}},d=function(a){var b=baseURL+"get_address_list/",d={"session-key":localStorage.session_key},e={id:a};data=JSON.stringify(e);var f=new AjaxHttpSender;f.sendPost(b,d,data,c)},e=function(a){$("#editaddress-container ol").empty(),$.each(a.address_list,function(a,b){$("#editaddress-container ol").append('<li class="address"><div class ="button"><a href="#" data-id="'+b.id+'" class="edit-address btn btn-small-secondary">EDIT</a><a href="#" data-id="'+b.id+'" class="remove-address btn btn-small-secondary">REMOVE</a></div><div class="address-content"><span class="address-name">'+b.first_name+" "+b.last_name+"</span>"+(1==b.is_business&&b.company.length>0?"<span>"+b.company+"</span>":"")+'<span class="address-street">'+b.street+", "+b.building+'</span><span class="address-city">'+b.city+", "+b.state+'</span><span class="address-mobile">'+b.phone+'</span><span class="address-zip">'+b.zip+'</span><span class="green primary-address add-primary" data-id="'+b.id+'">PRIMARY ADDRESS</span><span class="non-primary-address add-primary" data-id="'+b.id+'">MAKE THIS YOUR PRIMARY ADDRESS</span></div></li>'),1==b.is_primary?($(".primary-address:last").addClass("show"),$(".remove-address:last").addClass("hide")):($(".non-primary-address:last").addClass("show"),$(".remove-address:last").addClass("show"))})},f={success:function(a,b){var c=JSON.parse(a);1==c.status?(d(),$(".addresspopup-wrapper").hide()):showErrorPopup(c)},failure:function(a,b,c){}},g=function(){var a=$(".addaddress-popup"),b={first_name:a.find("input[name*='firstname']").val(),last_name:a.find("input[name*='lastname']").val(),phone:a.find("input[name*='phonenumber']").val(),zip:a.find("input[name*='zip']").val(),street:a.find("input[name*='street']").val(),city_id:a.find(".city-selector").val(),state_id:a.find(".state-selector").val(),building:a.find("input[class*='apartment']").val(),is_primary:1==a.find("input[name='is-primary']").is(":checked")?1:0,email:a.find("input[name*='email']").val(),is_business:a.find("input[name=is-business]").prop("checked")?1:0,company:a.find("input[id*='company-name']").val()};return b},h=function(){var a=g(),b=baseURL+"add_address/",c={"session-key":localStorage.session_key},d={first_name:a.first_name,last_name:a.last_name,phone:a.phone,zip:a.zip,city_id:a.city_id,street:a.street,building:a.building,is_primary:a.is_primary,email:a.email,state_id:a.state_id,is_business:a.is_business,company:a.company};data=JSON.stringify(d);var e=new AjaxHttpSender;e.sendPost(b,c,data,f)},i={success:function(a,b){var c=JSON.parse(a);1==c.status?(d(),$(".addresspopup-wrapper").hide()):showErrorPopup(c)},failure:function(a,b,c){}},j=function(a){var b=$(".addaddress-popup"),c=JSON.parse(localStorage.delivery_addressess);$.each(c.address_list,function(c,d){d.id==a&&(b.find(".state-selector").val(d.state_id),b.find("input[name*='firstname']").val(d.first_name),b.find("input[name*='lastname']").val(d.last_name),b.find("input[name*='phonenumber']").val(d.phone),b.find("input[name*='zip']").val(d.zip),b.find("input[name*='city']").val(d.city),b.find("input[name*='street']").val(d.street),b.find("input[class*='apartment']").val(d.building),b.find("input[name*='email']").val(d.email),1==d.is_primary?b.find("input[name='is-primary']").prop("checked",!0):b.find("input[name='is-primary']").prop("checked",!1),1==d.is_business?(b.find("input[name=is-business]").prop("checked",!0),$("#company-name").val(d.company),$("#companySection").show()):(b.find("input[name=is-business]").prop("checked",!1),$("#company-name").val(""),$("#companySection").hide()))})},k=function(a,b,c){var d=baseURL+"update_address/"+a+"/",e={"session-key":localStorage.session_key},f={};if(b?f.is_primary=b:f.is_primary=0,"justId"!=c){var h=g();f.first_name=h.first_name,f.last_name=h.last_name,f.phone=h.phone,f.zip=h.zip,f.city_id=h.city_id,f.street=h.street,f.building=h.building,f.email=h.email,f.state_id=h.state_id,f.is_business=h.is_business,f.company=h.company}data=JSON.stringify(f);var j=new AjaxHttpSender;j.sendPost(d,e,data,i)},l={success:function(a,b){var c=JSON.parse(a);localStorage["delivery-states"]=a,1==c.status?$.each(c.state_list,function(a,b){$(".state-selector").append($("<option/>",{value:b.id,text:b.name}))}):showErrorPopup(userDetails)},failure:function(a,b,c){}},m=function(){var a=baseURL+"get_states/",b={"session-key":localStorage.session_key},c={search:"New York"};data=JSON.stringify(c);var d=new AjaxHttpSender;d.sendPost(a,b,data,l)},n=function(){$("#editaddress-container .content ol").is(":empty")?($("#editaddress-container .content .message").show(),$(".update-delivery-address").hide()):($("#editaddress-container .content .message").hide(),$(".update-delivery-address").show())};return{editAddress:k,addAddress:h,removeAddress:b,populateAddressToForm:j,getStates:m,getAddress:d}}(),$(document).ready(function(){var a=new DeliveryAddressController;$(document).on("change",".state-selector",function(){$(this).val()}),$("#savepopup-data").on("click",function(b){if(b.preventDefault(),"SAVE ADDRESS"==$(this).val()){var c=$(this).attr("data-id"),d=0;$("form.addaddress-popup").valid()?($("input[name='is-primary']").is(":checked")&&(d=1),a.editAddress(c,d)):$("#address-line-1-error").is(":visible")&&$("#address-line-1,.apartment").addClass("margin-validate")}"ADD ADDRESS"==$(this).val()&&($("form.addaddress-popup").valid()?($("#address-line-1,.apartment").removeClass("margin-validate"),a.addAddress()):$("#address-line-1-error").is(":visible")&&$("#address-line-1,.apartment").addClass("margin-validate")),$("#isPrimary").removeAttr("disabled")}),$(document).on("click",".non-primary-address.add-primary",function(){var b=$(this).data().id;a.editAddress(b,1,"justId")}),$(document).on("click",".remove-address",function(){$(".popup-wrapper .content").find("span").text("Are you sure want to remove this address?"),$(".popup-wrapper").show();var b=$(this).data().id;$("#yes-button").on("click",function(){$(".popup-wrapper").hide(),a.removeAddress(b)}),$("#no-button").on("click",function(){$(".popup-wrapper").hide()})}),$("#add-address").on("click",function(){$(".addaddress-popup")[0].reset(),$("#companySection").hide(),$(".editaddress-popup .header span").text("ADD A NEW ADDRESS"),$("#savepopup-data").val("ADD ADDRESS"),userDetails&&$("#guest-email").val(userDetails.email),$("#savepopup-data").show(),$(".addresspopup-wrapper").show(),$("#address-line-1,.apartment").removeClass("margin-validate"),$("#isPrimary").removeAttr("disabled")}),$("#cancel").on("click",function(){$(".addaddress-popup").validate().resetForm(),$(".addresspopup-wrapper").hide(),$("#isBusiness").prop("checked",!1),$("#company-name").val(""),$("#companySection").hide(),$("#address-line-1,.apartment").removeClass("margin-validate"),$("#isPrimary").removeAttr("disabled")}),$(document).on("click",".edit-address",function(){$(".editaddress-popup .header span").text("EDIT ADDRESS"),$("#savepopup-data").val("SAVE ADDRESS"),currentId=$(this).data().id,$("#savepopup-data").attr("data-id",currentId),a.populateAddressToForm(currentId),$(".addresspopup-wrapper").show(),$("#address-line-1,.apartment").removeClass("margin-validate"),1===$(".address").length&&$("#isPrimary").prop("disabled","disabled")}),$(document).on("change","#isBusiness",function(a){$("#isBusiness").prop("checked")?$("#companySection").show():$("#companySection").hide()}),$("#companySection").hide(),a.getStates(),a.getAddress(),CartItemCount()});