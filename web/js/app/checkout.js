function haveAccountCheck(){var a=localStorage.loggedIn?JSON.parse(localStorage.loggedIn):null,b=localStorage.admin_loggedIn?JSON.parse(localStorage.admin_loggedIn):null;loggedIn=a||b,loggedIn&&$(".have-account").hide()}function setCurrentTime(){currentHourMin=getCurrentHourMin();var a=21,b=15;$(".today-content .checkout-time-button").each(function(c,d){currentHour=currentHourMin.substring(0,currentHourMin.length-3),console.log((new Date).getDay()),0!==(new Date).getDay()&&6!==(new Date).getDay()&&(currentHour>=a?($(this).remove(),$(".shop-status").show()):(currentMintues=parseInt(currentHourMin.slice(-2)),parseInt(currentHour)==$(d).data().hr&&($(this).prevAll(".set-time-button").remove(),$(this).val("NOW"),0===$(".checkout-time-button-active").length&&$(this).addClass("checkout-time-button-active"),currentMintues>=b&&($(this).addClass("button-disabled"),$(this).removeClass("checkout-time-button-active")))))});var c=new Date,d=weekendRestrictionDayCount(c.getDay()),e=d.firstDateCount,f=d.secondDateCount,g=getCurrentDateMonth(e);0==e?$(".today-content .content-heading").text("TODAY"):$(".today-content .content-heading").text(g),$(".today-content .content-heading").attr("data-date",getMonthDate(getCurrentDateTime(e))+"/"+getCurrentYear()),$(".today-content").find(".checkout-time-button").each(function(a,b){$(b).attr("data-date",getMonthDate(getCurrentDateTime(e))+"/"+getCurrentYear())});var h=getCurrentDateMonth(f);$(".week-content .content-heading").text(h),$(".week-content .content-heading").attr("data-date",getMonthDate(getCurrentDateTime(f))+"/"+getCurrentYear()),$(".week-content .checkout-time-button").each(function(a,b){$(b).attr("data-date",getMonthDate(getCurrentDateTime(f))+"/"+getCurrentYear())})}function timeActiveRestriction(a,b,c){$(a).on("click",function(){$(c).removeClass(b),$(this).addClass(b)})}function populateDate(a){var b=new Date;days=weekendRestrictionDayCount(b.getDay()),dateTime=a.delivery_time.split(" ")[0],dateMonth=a.delivery_time.substring(0,5).replace("-","/"),hour=a.delivery_time.substring(11,13),currentDate=getCurrentDateTime(days.firstDateCount).replace(/\//,"-"),tomorrowDate=getCurrentDateTime(days.secondDateCount).replace(/\//g,"-"),dateTime==currentDate?$(".today-content .checkout-time-button").each(function(a,b){$(b).data().hr==parseInt(hour)&&"N/A"!=$(b).val()&&($(".checkout-time-button-active").removeClass("checkout-time-button-active"),$(b).addClass("checkout-time-button-active"))}):dateTime==tomorrowDate&&(tommorrowSelector=$(".week-content .date-content").find(".checkout-time-button")[0],$(tommorrowSelector).trigger("click"),$(".week-content .set-time-button").each(function(a,b){$(b).data().hr==parseInt(hour)&&"N/A"!=$(b).val()&&($(".week-content .set-time-button").removeClass("checkout-time-button-active"),$(b).addClass("checkout-time-button-active"))}))}function populateDeliverySlotData(a){$.each(a.aaData,function(a,b){var c=b.date.replace(/\-/g,"/");for(var a in b)b.hasOwnProperty(a)&&0==b[a]&&(currentDateButton=$(".checkout-time-button[data-date='"+c+"'][data-slot='"+a+"']"),currentDateButton.length&&(currentDateButton[0].value="N/A",currentDateButton.addClass("time-slot-disabled"),currentDateButton.removeClass("checkout-time-button-active"),currentDateButton.removeClass("button-disabled")))})}function getDeliverySlots(){var a=getDateTimeRequiredFormat($(".today-content .content-heading").attr("data-date")),b=getDateTimeRequiredFormat($(".week-content .content-heading").attr("data-date")),c=baseURL+"get_delivery_slots/",d={"session-key":localStorage.session_key},e={from_date:a,to_date:b};data=JSON.stringify(e);var f=new AjaxHttpSender;f.sendPost(c,d,data,getDeliverySlotsCallback)}function getCartItems(){var a=baseURL+"get_cart_items/",b={"session-key":localStorage.session_key},c={};data=JSON.stringify(c);var d=new AjaxHttpSender;d.sendPost(a,b,data,getCartItemsCallback)}function saveDeliveryTime(a,b){var c=baseURL+"save_delivery_time/",d={"session-key":localStorage.session_key};a&&(params={delivery_time:a}),b&&(params={delivery_address:b}),data=JSON.stringify(params);var e=new AjaxHttpSender;e.sendPost(c,d,data,saveDeliveryTimeCallback,b)}function populateCartItems(a){$(".order-list-items").remove(),$(".items-container .item-count").text("("+a.total_count+")"),a.total_count>0?($(".total-delivery-cost").text("$2.95"),$(".driver-tip").val(5)):($(".total-delivery-cost").text("$0.00"),$(".driver-tip").val(0)),$(".driver-tip").val().length>0?$(".driver-tip-display").text("$"+parseFloat($(".driver-tip").val()).toFixed(2)):$(".driver-tip-display").text("$0.00"),$.each(a.aaData,function(a,b){$(".order-list-container").append("<div class='order-list-items' data-id='"+b.id+"'><img src='"+b.image+"'><span class='body-text-small'>"+b.name+"</span><div class='quantity-container'><span class='operator-minus' data-min='2'>-</span><input type='text' disabled='disabled' class='quantity' value='"+b.quantity+"'><span class='operator-plus' data-max='10'>+</span></div><span class='price-container' data-tax='"+b.tax+"' data-price='"+b.price+"'>"+dollarConvert(parseFloat((b.tax+b.price)*b.quantity).toFixed(2))+"</span><img src='../images/hamburger-menu-close.png' id='remove-cart-item'></div>")}),updateReciept()}function updateQuantity(){var a=$(".order-list-items").find(".quantity"),b=0;return $(a).each(function(a,c){b+=parseInt($(c).val())}),b}function updateReciept(a,b){var c=h=totalTaxCost=totalCost=0,d=0,e=0,f=0,g=parseFloat($(".driver-tip").val()),h=2.95;d=parseFloat($("#hidden-credit").val()),h=0,$("#pickup-radio").prop("checked")?(h=0,g=0,$(".driver-tip-container").hide(),$("span.total-delivery-cost").text("$0.00")):($(".order-list-items").length>0?(h=2.95,$("span.total-delivery-cost").text("$2.95"),$(".driver-tip").val().length>0?$(".driver-tip-display").text("$"+parseFloat($(".driver-tip").val()).toFixed(2)):$(".driver-tip-display").text("$0.00")):($("span.total-delivery-cost").text("$0.00"),$(".driver-tip").val(0),$(".driver-tip-display").text("$"+parseFloat($(".driver-tip").val()).toFixed(2))),$(".driver-tip-container").show(),g=parseFloat($(".driver-tip").val())),$(".order-list-items").each(function(a,b){quantity=parseInt($(b).find(".quantity").val()),price=parseFloat($(b).find(".price-container").attr("data-price")),tax=parseFloat($(b).find(".price-container").attr("data-tax")),c+=price*quantity,totalTaxCost+=tax*quantity}),isNaN(g)&&(g=0),f=c+totalTaxCost+h;var i="amount";"percentage"===cartItems.credit_type&&(totalDiscount=f*cartItems.credits/100,i="percentage"),f+=g,a&&!b&&(c=a.amount,totalTaxCost=a.tax,totalDiscount=a.discount,d=a.credits,i="gift"),"coupon-applied"==b&&(totalDiscount=a.discount,i="gift"),d+=totalDiscount,d>f?(e=f,f=0):(e=d,f-=d),e>0?$(".discount-container .discount-amount").text("-$"+e.toFixed(2)):$(".discount-container .discount-amount").text("$"+e.toFixed(2)),"percentage"===i&&$(".discount-container .discount-amount").text("-"+cartItems.credits+"%"),$(".items-container .total-item-cost").text("$"+c.toFixed(2)),$(".items-container .total-tax-cost").text("$"+totalTaxCost.toFixed(2)),$(".total-cost").text("$"+f.toFixed(2)),$(".total-cost").val(f)}function removeCartItems(a){var b=baseURL+"remove_from_cart/",c={"session-key":localStorage.session_key},d={meal_id:a};data=JSON.stringify(d);var e=new AjaxHttpSender;e.sendPost(b,c,data,removeCartItemsCallback)}function clearCart(){var a=baseURL+"delete_cart/",b={"session-key":localStorage.session_key},c={};data=JSON.stringify(c);var d=new AjaxHttpSender;d.sendPost(a,b,data,clearCartCallback)}function updateCartItems(a,b){var c=baseURL+"update_cart/",d={"session-key":localStorage.session_key},e={meal_id:a,quantity:b};data=JSON.stringify(e);var f=new AjaxHttpSender;f.sendPost(c,d,data,updateCartItemsCallback)}function saveCreditCardDetails(){var a=baseURL+"save_credit_card/",b=$("#card-number").val(),c=$("#cvv-number").val(),d=$("#ExpMonth").val(),e=$("#ExpYear option:selected").text(),f={"session-key":localStorage.session_key},g={number:b,exp_month:d,exp_year:e,cvv2:c,first_name:"first_name",last_name:"last_name"};data=JSON.stringify(g);var h=new AjaxHttpSender;h.sendPost(a,f,data,creditCardAddToDbCallback)}function savedCardDetails(){var a=baseURL+"get_saved_cards/",b={"session-key":localStorage.session_key},c={};data=JSON.stringify(c);var d=new AjaxHttpSender;d.sendPost(a,b,data,savedCardDetailsCallback)}function populateCardDetails(a,b){$(".saved-cards").html(""),b?$.each(a,function(c,d){last_num=a[c].number.slice(-4),b==d.id&&$(".saved-cards").append("<div class='saved-card-list'><input type='radio' class='checkbox-green added-card pullLeft payment-checked' name='saved-card' id='"+d.id+"' class='radio-button-payment'><label for='"+d.id+"'><img class='paypal' src='"+d.logo+"'><span class='body-text-small'>"+d.type+" ending in "+last_num+"</span><span class='body-text-small'>Expires on "+d.expire_month+"/"+d.expire_year+"</span></label></div>")}):$.each(a,function(b,c){last_num=a[b].number.slice(-4),$(".saved-cards").append("<div class='saved-card-list'><input type='radio' class='checkbox-green added-card pullLeft payment-checked' name='saved-card' id='"+c.id+"' class='radio-button-payment'><label for='"+c.id+"'><img class='paypal' src='"+c.logo+"'><span class='body-text-small'>"+c.type+" ending in "+last_num+"</span><span class='body-text-small'>Expires on "+c.expire_month+"/"+c.expire_year+"</span></label></div>")})}function mobileResponsive(){$(window).width()<=767&&$(window).width()>=320?($(".delivery-info-container").removeClass("box-border"),$(".delivery-time-container").removeClass("box-border"),$(".delivery-info").addClass("box-border"),$(".payment-info").addClass("box-border"),$(".time-container").addClass("box-border")):($(".delivery-time-container").addClass("box-border"),$(".delivery-info-container").addClass("box-border"),$(".delivery-info").removeClass("box-border"),$(".payment-info").removeClass("box-border"),$(".time-container").removeClass("box-border"))}function getAddress(a){var b=baseURL+"get_address_list/",c={"session-key":localStorage.session_key},d={checkout:1};data=JSON.stringify(d);var e=new AjaxHttpSender;e.sendPost(b,c,data,getAddressCallback,a)}function popuplateAddressList(a){if(userDetails=JSON.parse(a),1==userDetails.status)if(0!=userDetails.address_list.length)$(".address-info-guest").hide(),localStorage.delivery_addressess=a,populateAddresstoInfoContainer(userDetails);else{if(null!==localStorage.getItem("user_profile")){var b=JSON.parse(localStorage.user_profile);$(".address-info-guest").find("#guest-email").val(b.email),$(".address-info-guest").find("#guest-phone").val(b.mobile)}else getProfile();$(".address-info").hide(),$(".address-info-guest").show(),haveAccountCheck()}else showErrorPopup(userDetails)}function populateAddresstoInfoContainer(a){$(".address-info .contents").remove();var b=a.delivery_address;b&&$.each(a.address_list,function(a,c){c.id==b&&$(".address-info").append("<div class='contents address-added' data-id='"+c.id+"'><span class='content-heading'>DELIVERY ADDRESS</span><span>"+c.first_name+" "+c.last_name+"</span>"+(1==c.is_business&&c.company.length>0?"<span>"+c.company+"</span>":"")+"<span>"+c.street+", "+c.building+"</span><span>"+c.city+", "+c.state+" "+c.zip+"</span><span>"+c.phone+"</span><span class='change-address-payment' id='change-address'>CHANGE ADDRESS</span></div>"),$("#guest-email").val(c.email),$("#guest-phone").val(c.phone)}),$(".address-info-guest").hide(),$(".address-info").show()}function populateAddressListPopup(){if($(".address-payment-list-popup .popup-container").empty(),$(".address-payment-list-popup .button").remove(),$("#save-delivery-address").addClass("button-disabled"),$(".address-payment-list-popup .popup .header").text("SELECT YOUR DELIVERY ADDRESS"),void 0!=localStorage.delivery_addressess&&null!=localStorage.delivery_addressess&&"true"==localStorage.loggedIn){JSON.parse(localStorage.delivery_addressess).address_list.length;addressList=JSON.parse(localStorage.delivery_addressess),appendAddresscontent(addressList),$(".address-payment-list-popup").show()}else getAddress("populateAddressToPopUp"),$(".address-payment-list-popup").show()}function appendAddresscontent(a){$(".address-payment-list-popup .popup-container").append("<div class='delivery-adress-wrapper'></div>"),$.each(a.address_list,function(a,b){$(".address-payment-list-popup .popup-container .delivery-adress-wrapper").append("<div class='address-container'><input type='radio' name='address' id='"+b.id+"1' data-id='"+b.id+"' class='checkbox-green radio-button'><label class='list-address' for='"+b.id+"1' data-email = '"+b.email+"' data-phone='"+b.phone+"'><span>"+b.first_name+" "+b.last_name+"</span>"+(1==b.is_business&&b.company.length>0?"<span>"+b.company+"</span>":"")+"<span>"+b.street+", "+b.building+"</span><span>"+b.city+", "+b.state+" "+b.zip+"</span><span>"+b.phone+"</span></label></div>")}),$(".address-payment-list-popup .popup-container").append("<div class='button'><a href='#' id='add-address-popup'>ADD A NEW ADDRESS</a><a href='#' class='btn btn-medium-primary medium-green button-disabled' id='save-delivery-address'>SELECT</a><a href='#' class='btn btn-medium-secondary' id='cancel'>CANCEL</a></div>")}function setPrimaryAdd(a){var b=baseURL+"update_address/"+a+"/",c={"session-key":localStorage.session_key},d={is_primary:1};data=JSON.stringify(d);var e=new AjaxHttpSender;e.sendPost(b,c,data,setPrimaryAddCallback)}function changeDeliveryAddress(a){var b=$(".address-payment-list-popup .popup-container").find("[data-id='"+a+"']").parent().find("label"),c='<span class="content-heading" id="'+a+'">DELIVERY ADDRESS</span>'+b.html()+'<span class="change-address-payment" id="change-address">CHANGE ADDRESS</span>';$(".address-added").attr("data-id",a),$(".address-info .contents").html(c),$("#guest-email").val(b.data("email")),$("#guest-phone").val(b.data("phone"))}function addAddress(a){var b=getNewAddress(a),c=baseURL+"add_address/",d={"session-key":localStorage.session_key},e={first_name:b.first_name,last_name:b.last_name,phone:b.phone,zip:b.zip,email:b.email,city_id:b.city_id,state_id:b.state_id,street:b.street,building:b.building,is_primary:b.is_primary,checkout:1,is_business:b.is_business,company:b.company};data=JSON.stringify(e);var f=new AjaxHttpSender;f.sendPost(c,d,data,addAddressCallback,a)}function getNewAddress(a){var b;b="popup"==a?$("#new-address-form"):$("#guest-address-info");var c=b.find(".state-selector").val(),d=b.find("input[name*='city']").val(),e=b.find(".state-selector option:selected").text(),f={first_name:b.find("input[name*='firstname']").val(),last_name:b.find("input[name*='lastname']").val(),phone:b.find("input[name*='phonenumber']").val(),zip:b.find("input[name*='zip']").val(),street:b.find("input[name*='street']").val(),email:b.find("input[name*='email']").val(),city_id:d,city:d,building:b.find("input[class*='apartment']").val(),is_primary:"popup"==a?0:1,state_id:c,state:e,is_business:b.find("input[id*='business']").prop("checked")?1:0,company:b.find("input[name*='company']").val()};return f}function getStates(){var a=baseURL+"get_states/",b={},c={search:"New York"};data=JSON.stringify(c);new AjaxHttpSender;(new AjaxHttpSender).sendPost(a,b,data,getStatesCallback)}function populateAddedAddress(a,b){var c=[],d={},e=getNewAddress(b);e.id=a,"true"==localStorage.loggedIn&&localStorage.getItem("delivery_addressess")&&(d=JSON.parse(localStorage.delivery_addressess),d.address_list.push(e),localStorage.delivery_addressess=JSON.stringify(d)),c.push(e),data={address_list:c,delivery_address:a},populateAddresstoInfoContainer(data)}function setEcommerceOrderConfirm(a){var b=a.cart_items.delivery_address;a.cart_items.delivery_address||(b="pickup"),ga("ecommerce:addTransaction",{id:a.cart_items.transaction_id,affiliation:"Meisterdish",revenue:a.cart_items.grand_total,shipping:a.cart_items.shipping,tax:a.cart_items.tax,dimension1:b}),$.each(a.cart_items.aaData,function(a,b){ga("ecommerce:addItem",{id:b.id,name:b.name,category:b.category,price:b.price,quantity:b.quantity})}),ga("ecommerce:send")}function convertDateFormat(a,b,c){return selectedDayDateFormat=stringToDate(a,"mm/dd/yyyy","/"),selectedDayDateFormatWithHour=new Date(selectedDayDateFormat.setHours(b)),getEstFormattedForWebService(selectedDayDateFormatWithHour)}function createOrderParams(){var a,b,c,d=$("#driver-description").val(),e=$(".driver-tip").val(),f=$(".address-info .contents").attr("data-id"),g=$("#name-on-card").val().split(" "),h=$("input[name='delivery-method']:checked").data("type"),i=g[0],j=g[1],k=$(".today-content").find(".checkout-time-button-active"),l=($(".week-content .date-content").find(".checkout-time-button-active"),$(".week-content .time-content").find(".checkout-time-button-active")),m=0,n=0,o=$(".saved-cards .added-card:checked").attr("id"),p=$("#card-number").val(),q=($("#cvv-number").val(),$("#ExpMonth").val()),r=$("#ExpYear option:selected").text(),s=$("#guest-phone").val(),t=$("#guest-email").val();return k.length?(a=k.attr("data-date"),selected_hour=k.attr("data-hr"),b=getHourCorrected(selected_hour)+":00:00",c=convertDateFormat(a,selected_hour,b)):(a=l.attr("data-date"),selected_hour=l.attr("data-hr"),b=getHourCorrected(l.attr("data-hr"))+":00:00",c=convertDateFormat(a,selected_hour,b)),$("input:checkbox[name=save-card-details]").prop("checked")&&(m=1),$("#cc").prop("checked")&&(n="cc"),fullOrderParams={driver_instructions:d,tip:e,delivery_address:f,billing_address:billingAddressId,delivery_type:h,first_name:i,last_name:j,delivery_time:c,payment_type:n,save_card:m,card_id:o,number:p,exp_month:q,cvv2:$("#cvv-number").val(),exp_year:r,email:t,phone:s}}function placeOrder(){url=baseURL+"create_order/",header={"session-key":localStorage.session_key},$(".saved-cards").is(":empty")?$("#pay-form").valid()&&$("#pay-form").submit():cardSavedParams()}function cardSavedParams(){var a=createOrderParams();orderParams={delivery_time:a.delivery_time,billing_address:a.billing_address,delivery_address:a.delivery_address,email:a.email,phone:a.phone,payment_type:"cc",tip:a.tip,delivery_type:a.delivery_type,driver_instructions:a.driver_instructions,card_id:a.card_id},"undefined"!=typeof orderParams&&createOrder(orderParams)}function cardNotSavedCreateOrder(a){var b=createOrderParams();orderParams={delivery_time:b.delivery_time,billing_address:b.billing_address,delivery_address:b.delivery_address,email:b.email,phone:b.phone,payment_type:"cc",tip:b.tip,delivery_type:b.delivery_type,driver_instructions:b.driver_instructions,stripeToken:a},createOrder(orderParams)}function createOrder(a){data=JSON.stringify(a);var b=new AjaxHttpSender;b.sendPost(url,header,data,placeOrderCallback),$(".loading-indicator").show()}function populateCreditCardDetails(){var a=cardDetails.cards;$(".address-payment-list-popup .button").remove(),$(".address-payment-list-popup .popup-container").empty(),$(".address-payment-list-popup .popup .header").text("SELECT YOUR PAYMENT METHOD"),$(".address-payment-list-popup .popup-container").append("<div class='popup-sub-wrapper'></div>"),$.each(a,function(a,b){$(".address-payment-list-popup .popup-container .popup-sub-wrapper").append("<div class='payment-popup-sub-container'><input type='radio' class='checkbox-green added-card pullLeft' name='change-card' class='radio-button-payment' data-id='"+b.id+"' id='"+b.id+"1'><label for='"+b.id+"1'><img class='paypal' src='"+b.logo+"'><span class='body-text-small'>"+b.type+" ending in "+b.number.slice(-4)+"</span><span class='body-text-small'>Expires on "+b.expire_month+"/"+b.expire_year+"</span></label></div>")}),$(".address-payment-list-popup .popup-container").append("<div class='button'><a href='#' class='btn btn-medium-primary medium-green' id='save-payment'>SELECT</a><a href=\"#\" class=\"btn btn-medium-secondary\" id=\"addCreditCard\">ADD CREDIT CARD</a><a href='#' class='btn btn-medium-secondary' id='cancel'>CANCEL</a></div>"),$("#save-payment").addClass("button-disabled"),$(".address-payment-list-popup").show(),$("input[type=radio][name=change-card]").on("click",function(){$("#save-payment").removeClass("button-disabled")})}function showSelectedPaymentMethod(a){$(".credit-card-container").show(),$(".saved-cards").empty(),populateCardDetails(cardDetails.cards,a)}function validateOrder(){var a={};return a.message="","undefined"==typeof cartItems||"-1"==cartItems.status?(a.message="Add meals to cart and then proceed",showPopup(a),!1):$(".checkout-time-button-active").length?$(".total-cost").val()>0&&!$(".payment-checked:checked").length?(a.message="Add a method of payment and then proceed",showPopup(a),!1):$("#delivery-radio").is(":checked")&&!$(".address-added").length?(a.message="Add an address then proceed",showPopup(a),!1):$("#pickup-radio").is(":checked")&&!$("#guest-address-info").valid()?(a.message="Check your phone number and email",showPopup(a),!1):$("#tip-form").valid()?!0:(a.message="Please enter a valid tip",showPopup(a),!1):($("#pickup-radio").prop("checked")?a.message="Add pickup time and then proceed":a.message="Add delivery time and then proceed",showPopup(a),!1)}function checkPromoCode(a){var b=baseURL+"apply_promocode/",c={"session-key":localStorage.session_key},d={code:a};data=JSON.stringify(d);var e=new AjaxHttpSender;e.sendPost(b,c,data,checkPromoCodeCallback)}function removePromocode(){var a=baseURL+"remove_promocode/",b={"session-key":localStorage.session_key},c={};data=JSON.stringify(c);var d=new AjaxHttpSender;d.sendPost(a,b,data,removePromocodeCallback)}function populateCoupon(a){var b=a.code,c=a.amount,d=a.message,e="coupon-applied",f={};f.discount=c,$(".isPromocode-wrapper").slideDown(),$("#promo-gift-input").val(b),$(".promo-validation-message").css("color","#8EC657"),$(".promo-validation-message").text(d),$("#apply-promo-gift").removeClass("btn-small-primary medium-green").addClass("btn-small-secondary"),$("#apply-promo-gift").val("DELETE"),$(".discount-container .discount-amount").css("color","#8EC657"),updateReciept(f,e)}function getProfile(){var a=baseURL+"get_profile/",b={"session-key":localStorage.session_key},c={get:1};data=JSON.stringify(c);var d=new AjaxHttpSender;d.sendPost(a,b,data,getProfileCallback)}function detectDevice(){var a=navigator.userAgent.toString().toLowerCase(),b={Android:function(){return/android/i.test(a)},iOS:function(){return/iphone|ipad|ipod/i.test(a)},Desktop:function(){return/windows|linux|macintosh/i.test(a)}};return b}function fixGoogleMapLink(){var a=detectDevice();a.iOS()?$("#google-maps-link").attr("href","http://maps.google.com/maps?daddr=Meisterdish+218+E+81st+St+New+York+NY+10028+United+States"):$("#google-maps-link").attr("href","http://maps.google.com/maps?saddr=Current+Location&daddr=Meisterdish+218+E+81st+St+New+York+NY+10028+United+States")}function resetSlots(){var a=$(".checkout-time-button");$.each(a,function(a,b){$(b).val(slotsObject[$(b).attr("data-slot")]),$(b).removeClass("time-slot-disabled").addClass("checkout-time-button").addClass("set-time-button")}),setCurrentTime()}function loadViewDefaults(){$(".forminput-wrapper input").removeClass("error"),$("#companyWrapper").hide(),$("#guest-address-info .regular-checkbox").prop("checked")&&$("#companyWrapper").toggle(),$("#companySection").hide(),$("#new-address-form .regular-checkbox").prop("checked")&&$("#companySection").toggle(),$("#pickup-radio").removeAttr("checked"),$("#delivery-radio").prop("checked","checked")}function populateYear(a){var b=(new Date).getFullYear();a.html("");for(var c=1;20>=c;c++)a.append("<option value='"+b+"'>"+b+"</option>"),b+=1}function bindEvents(){$("#guest-address-info .regular-checkbox").on("click",function(){$("#companyWrapper").toggle()}),$("#new-address-form .regular-checkbox").on("click",function(){$("#companySection").toggle()}),$(document).on("click","#addCreditCard",function(a){a.preventDefault(),resetCreditCardDetails(),$(".credit-card-wrapper").show(),$(".address-payment-list-popup").hide(),populateYear($("#expiryYear"))}),$(document).on("click","#close-new-credit-card-form",function(a){a.preventDefault(),$("#payForm").validate().resetForm(),$(".credit-card-wrapper").hide()}),$("#payForm").on("submit",function(a){a.preventDefault()}),$("#addPopupCreditCard").off().on("click",function(a){a.preventDefault(),$("#payForm").valid()&&($("#addPopupCreditCard").prop("disabled",!0),StripeController.createToken($("#payForm"),creditCardAddToStripeCallback))}),$("#saveFirstCreditCard").on("click",function(a){a.preventDefault();var b=$(".payment-method-guest-container #pay-form");if(b.valid()){var c={};if(void 0===localStorage.cartItems||null===localStorage.cartItems)return c.message="Add meals to cart and then proceed",showPopup(c),!1;$("#saveFirstCreditCard").prop("disabled",!0),StripeController.createToken(b,creditCardAddToStripeCallback)}}),$(document).ajaxStop(function(){$(".loading-indicator").hide()})}function creditCardAddToStripeCallback(a,b,c){if(b.error){$(".credit-card-wrapper").hide(),c.find("button").prop("disabled",!1);var d={};return d.message=b.error.message,void showPopup(d)}creditCardAddToDb(b.id)}function creditCardAddToDb(a){var b=baseURL+"save_credit_card/",c={"session-key":localStorage.session_key},d={stripeToken:a},e=JSON.stringify(d);(new AjaxHttpSender).sendPost(b,c,e,creditCardAddToDbCallback)}function resetCreditCardDetails(){$(".credit-card-wrapper #payForm #card-number").val(""),$(".credit-card-wrapper #payForm #nameOnCard").val(""),$(".credit-card-wrapper #payForm #cvv-number").val(""),$(".credit-card-wrapper #payForm #ExpMonth option:selected").prop("selected","1"),populateYear($(".credit-card-wrapper #payForm #expiryYear")),$("#addPopupCreditCard").prop("disabled",!1)}var billingAddressId,cardDetails,payPalEmail="nazz007online-facilitator@gmail.com",returnUrl=baseURL+"paypal_success/",cancelReturnUrl=homeUrl+"/views/checkout.html",notifyUrl=baseURL+"paypal_ipn/",totalDiscount=0,tipAmt=null,decimalPoint=0,cartItems=[],slotsObject={slot1:"4-5pm",slot2:"5-6pm",slot3:"6-7pm",slot4:"7-8pm",slot5:"8-9pm"};$(document).ready(function(){function a(a,b){var c=a.which?a.which:a.keyCode;return 190==c&&-1==$(b).val().indexOf(".")||110==c&&-1==$(b).val().indexOf(".")||!(48>c&&8!=c||c>57&&96>c||c>105)?!0:!1}loadViewDefaults(),bindEvents(),$(".loading-indicator").show(),$("#tip-error").css("width","144px"),CartItemCount(),localStorage.session_key?(getAddress(),getCartItems(),savedCardDetails()):($(".address-info-guest").show(),$(".address-info").hide(),$(".payment-method-guest-container").show(),$(".emtpy-cart-message").text("There are no items in cart."),$(".emtpy-cart-message").show()),stripeIntegration(),setCurrentTime(),populateYear($("#ExpYear")),fixGoogleMapLink(),getDeliverySlots(),getStates();$(document).on("click","#remove-cart-item",function(){var a=$(this).parent().attr("data-id");removeCartItems(a)}),$("#tip-form").on("submit",function(a){a.preventDefault()}),$(".driver-tip").on("keydown",function(b){return a(b,this)}).on("keyup",function(a){selectedTip=0,$(".driver-tip-display").text("$0.00"),selectedTip=this.value,isNaN(selectedTip)||0===selectedTip.length?$(".driver-tip-display").text("$0.00"):selectedTip>=0&&$(".driver-tip-display").text("$"+parseFloat(selectedTip).toFixed(2)),$("#tip-form").valid()&&updateReciept()}).on("blur",function(a){var b=$(this);""===b.val()&&b.val(0)}).on("input",function(a){var b=$(this).attr("dataLength"),c=parseInt($(this).val())+"";c.length>b&&$(this).val($(this).val().slice(0,b))}),$(".set-time-button").on("click",function(){var a=$(this).attr("data-date");requiredDateTime=getDateTimeRequiredFormat(a)+" "+$(this).attr("data-hr")+":00:00",saveDeliveryTime(requiredDateTime)}),timeActiveRestriction(".week-content input[type=button]","checkout-time-button-active",".today-content input[type=button]"),timeActiveRestriction(".today-content input[type=button]","checkout-time-button-active",".week-content input[type=button]"),timeActiveRestriction(".today-content .checkout-time-button","checkout-time-button-active",".today-content .checkout-time-button"),timeActiveRestriction(".week-content .checkout-time-button","checkout-time-button-active",".week-content .checkout-time-button"),$(document).on("click",".order-list-items",function(){$("span#remove-cart-item").show()}),$(document).on("click",".operator-plus",function(){var a=parseInt($(this).parent().find(".quantity").val()),b=a+2,c=$(this).parents(":eq(1)").attr("data-id"),d=b,e=$(this).parents().eq(1).find(".price-container"),f=e.data("price"),g=e.data("tax");b<=$(this).data("max")&&$(this).parent().find(".quantity").val(b),10>=d&&($(this).parents().eq(1).find(".price-container").text(dollarConvert(((f+g)*d).toFixed(2))),updateCartItems(c,d),updateReciept(),$(".item-count").text("("+updateQuantity()+")"))}),$(document).on("click","#save-payment",function(){var a=$("input[type=radio][name=change-card]:checked").attr("data-id");showSelectedPaymentMethod(a),$(".address-payment-list-popup").hide()}),$(document).on("click",".operator-minus",function(){var a=parseInt($(this).parent().find(".quantity").val()),b=a-2,c=$(this).parents(":eq(1)").attr("data-id"),d=b,e=$(this).parents().eq(1).find(".price-container"),f=e.data("price"),g=e.data("tax");a>$(this).data("min")&&$(this).parent().find(".quantity").val(b),d>=1&&($(this).parents().eq(1).find(".price-container").text(dollarConvert(((f+g)*d).toFixed(2))),updateCartItems(c,d),updateReciept(),$(".item-count").text("("+updateQuantity()+")"))}),$(document).on("click","input[type=radio][name=address]",function(){$("#save-delivery-address").removeClass("button-disabled")}),$(document).on("click","#change-address",function(){populateAddressListPopup()}),$(document).on("click","#add-address-popup",function(){loadViewDefaults(),"true"!=localStorage.loggedIn&&getProfile(),$("#new-address-form").validate().resetForm(),$(".address-payment-list-popup").hide(),$(".addresspopup-wrapper").show()}),$("#close-new-address-form").on("click",function(){$(".regular-checkbox").prop("checked",!1),$(".addresspopup-wrapper").hide()}),$(document).on("click","#save-new-address",function(a){a.preventDefault(),$("#new-address-form").valid()&&addAddress("popup")}),$(document).on("click","#cancel",function(){$(".address-payment-list-popup").hide()}),$(document).on("click","#save-delivery-address",function(){var a=$("input[type=radio][name=address]:checked").attr("data-id");saveDeliveryTime("",a),$(".address-payment-list-popup").hide()}),$("#add-guest-address").on("click",function(a){if(a.preventDefault(),$("#guest-address-info").valid()){if(void 0===localStorage.cartItems||null===localStorage.cartItems){var b={};return b.message="Add meals to cart and then proceed",showPopup(b),!1}addAddress()}}),$("#change-payment-method").on("click",function(){populateCreditCardDetails()}),$("#promo-gift-input").on("keydown",function(a){13==a.keyCode&&$("#apply-promo-gift").trigger("click")}),$("#apply-promo-gift").on("click",function(){var a=$("#apply-promo-gift").val(),b=$("#promo-gift-input").val(),c=b.length;$(".promo-validation-message").empty(),"APPLY"==a&&($(".promo-validation-message").css("color","#ff7878"),"true"!=localStorage.loggedIn?$(".promo-validation-message").text("You must be logged in to use coupons."):""==b?$(".promo-validation-message").text("* Please enter Giftcard/Promocode."):c>9?$(".promo-validation-message").text("* Please enter valid Giftcard/Promocode."):checkPromoCode(b)),"DELETE"==a&&($("#promo-gift-input").val(""),removePromocode())}),$("#place-order").on("click",function(a){a.preventDefault(),validateOrder()&&placeOrder()}),$("#pay-form").submit(function(a){a.preventDefault()}),$("#pickup-radio").on("click",function(){resetSlots(),$(".regular-checkbox").prop("checked",!1),$(".address-info-guest").show(),$(".address-info").hide(),$("#guest-address-info input").removeClass("error"),$("#guest-address-info").validate().resetForm(),$("#guest-address-info").find("input").not("#guest-email, #hidden-pickupPhone,#hidden-pickupEmail,#guest-phone,#add-guest-address").val(""),$("#guest-address-info").find("input").not("#guest-email, #guest-phone,#add-guest-address").addClass("autofillremove"),
$("#guest-address-info").find("input").not("#guest-email, #guest-phone").attr("disabled","disabled"),$("#guest-address-info").find("input").not("#guest-email, #guest-phone").addClass("button-disabled"),$(".pickup-content").show(),$("#add-guest-address").hide(),$(".state-selector-container").hide(),$(".instruction-container .content-heading").hide(),$(".instruction-container textarea").hide(),updateReciept(),"true"==localStorage.loggedIn&&$(".have-account").hide()}),$("#delivery-radio").on("click",function(){getDeliverySlots(),$(".address-info").is(":empty")?($(".address-info-guest").show(),$(".address-info").hide()):($(".address-info").show(),$(".address-info-guest").hide()),$(".instruction-container .content-heading").show(),$(".instruction-container textarea").show(),$("#guest-address-info").find("input").not("#guest-email, #guest-phone").removeAttr("disabled"),$("#guest-address-info").find("input").not("#guest-email, #guest-phone").removeClass("button-disabled"),$("#guest-address-info").find("input").not("#guest-email, #guest-phone").removeClass("autofillremove"),"true"==!localStorage.loggedIn&&$(".have-account").show(),$(".pickup-content").hide(),$("#add-guest-address").show(),$(".state-selector-container").show(),updateReciept(),$("#tip-form").validate().resetForm(),$("#guest-address-info").validate().resetForm(),loadViewDefaults()}),$("#is-gift-card").on("click",function(){$(".isPromocode-wrapper").slideToggle()})});var getDeliverySlotsCallback={success:function(a,b){deliverySlotData=JSON.parse(a),1==deliverySlotData.status?$("#delivery-radio").prop("checked")&&populateDeliverySlotData(deliverySlotData):showPopup(deliverySlotData)},failure:function(a,b,c){}},getCartItemsCallback={success:function(a,b){localStorage.cartItems=a,cartItems=JSON.parse(a),1==cartItems.status?($(".emtpy-cart-message").hide(),cartItems.total_count>0?($(".total-delivery-cost").text("$2.95"),$(".driver-tip").val(5)):($(".total-delivery-cost").text("$0.00"),$(".driver-tip").val(0)),$(".driver-tip").val().length>0?$(".driver-tip-display").text("$"+parseFloat($(".driver-tip").val()).toFixed(2)):$(".total-delivery-cost").text("$0.00"),populateCartItems(cartItems),populateDate(cartItems),null!=cartItems.coupon&&populateCoupon(cartItems.coupon),cartItems.credits&&$(".discount-container .discount-amount").css("color","#8EC657"),"percentage"===cartItems.credit_type?($(".discount-container .discount-amount").text("-"+cartItems.credits+"%"),$("#hidden-credit").val("0")):"amount"===cartItems.credit_type&&(cartItems.credits>0?$(".discount-container .discount-amount").text("-$"+cartItems.credits.toFixed(2)):$(".discount-container .discount-amount").text("$"+cartItems.credits.toFixed(2)),$("#hidden-credit").val(cartItems.credits))):($(".order-list-items").remove(),$(".emtpy-cart-message").empty(),$(".emtpy-cart-message").append("<span>"+cartItems.message+"</span>"),$(".emtpy-cart-message").show(),$(".items-container .item-count").text("(0)")),updateReciept()},failure:function(a,b,c){}},saveDeliveryTimeCallback={success:function(a,b,c){var d=JSON.parse(a);-1==d.status?showPopup(d):c&&changeDeliveryAddress(c)},failure:function(a,b,c){}},removeCartItemsCallback={success:function(a,b){if(removeData=JSON.parse(a),1==removeData.status){CartItemCount(),getCartItems();var c=removeData.message;$(".popup-message span").text(c),$(".popup-message").show(),setTimeout(function(){$(".popup-message").hide()},2e3)}},failure:function(a,b,c){}},clearCartCallback={success:function(a,b){CartItemCount(),getCartItems()},failure:function(a,b,c){}},updateCartItemsCallback={success:function(a,b){var c=JSON.parse(a);1==c.status&&(CartItemCount(),localStorage.cartItems=a)},failure:function(a,b,c){}},creditCardAddToDbCallback={success:function(a,b){var c=JSON.parse(a);1==c.status&&savedCardDetails()},failure:function(a,b,c){}},savedCardDetailsCallback={success:function(a,b){cardDetails=JSON.parse(a),1==cardDetails.status?0!=cardDetails.cards.length?(populateCardDetails(cardDetails.cards),$(".payment-method-container").show(),$(".payment-method-guest-container").hide()):($(".payment-method-guest-container").show(),$("#firstCreditCardBtn").show()):showPopup(cardDetails)},failure:function(a,b,c){}};$(window).resize(function(){mobileResponsive()}),$(window).load(function(){mobileResponsive()});var getAddressCallback={success:function(a,b,c){userDetails=JSON.parse(a),1==userDetails.status&&(addressList=userDetails.address_list,$.each(addressList,function(a,b){1==b.is_primary&&(billingAddressId=b.id)}),1===addressList.length&&0===addressList[0].is_primary&&(setPrimaryAdd(addressList[0].id),billingAddressId=addressList[0].id,userDetails.delivery_address=billingAddressId),"populateAddressToPopUp"==c?appendAddresscontent(userDetails):popuplateAddressList(JSON.stringify(userDetails)))},failure:function(a,b,c){}},setPrimaryAddCallback={success:function(a,b){JSON.parse(a)},failure:function(a,b,c){}},addAddressCallback={success:function(a,b,c){var d=JSON.parse(a);1==d.status?(populateAddedAddress(d.id,c),$(".addresspopup-wrapper").fadeOut()):"popup"==c?showPopup(d):(showPopup(d),$(".address-info-guest").show())},failure:function(a,b,c){}},getStatesCallback={success:function(a,b){var c=JSON.parse(a);localStorage["delivery-states"]=a,$(".state-selector").html(""),1==c.status?$.each(c.state_list,function(a,b){$(".state-selector").append($("<option/>",{value:b.id,text:b.name}))}):showErrorPopup(userDetails)},failure:function(a,b,c){}},placeOrderCallback={success:function(a,b){var c=JSON.parse(a);if(1==c.status){setEcommerceOrderConfirm(c);var d=localStorage.loggedIn?JSON.parse(localStorage.loggedIn):null,e=localStorage.admin_loggedIn?JSON.parse(localStorage.admin_loggedIn):null,f=d||e;$(".ok-container").show(),$(".close-container").hide(),f?($(".ok-container a").attr("href","orderhistory.html"),showPopup(c)):($(".ok-container a").attr("href","../index.html"),showPopup(c)),SessionController.fbTrackConversionEvent(SessionController.getPlaceOrderPixel(),c.cart_items.grand_total,"USD")}else showPopup(c);$(".loading-indicator").hide()},failure:function(a,b,c){}},checkPromoCodeCallback={success:function(a,b){var c=JSON.parse(a);1==c.status&&($("#apply-promo-gift").removeClass("btn-small-primary medium-green").addClass("btn-small-secondary"),$("#apply-promo-gift").val("DELETE"),$(".promo-validation-message").css("color","#8EC657"),$(".promo-validation-message").text("* "+c.message),$(".discount-container .discount-amount").css("color","#8EC657"),updateReciept(c)),-1==c.status&&($(".promo-validation-message").css("color","#ff7878"),$(".promo-validation-message").text("* "+c.message))},failure:function(a,b,c){}},removePromocodeCallback={success:function(a,b){removeData=JSON.parse(a),1==removeData.status&&($("#apply-promo-gift").removeClass("btn-small-secondary").addClass("btn-small-primary medium-green"),$("#apply-promo-gift").val("APPLY"),$(".promo-validation-message").css("color","#8EC657"),removeData.credits>0||$(".discount-container .discount-amount").css("color","#4A4A4A"),$(".promo-validation-message").text("* "+removeData.message),updateReciept(removeData))},failure:function(a,b,c){}},getProfileCallback={success:function(a,b){var c=JSON.parse(a);1==c.status&&(localStorage.user_profile=a,$(".address-info-guest").find("#guest-email").val(c.email),$(".address-info-guest").find("#guest-phone").val(c.mobile),"true"==localStorage.loggedIn&&$("#new-address-form").find("input[name*='email']").val(c.email))},failure:function(a,b,c){}},creditCardAddToDbCallback={success:function(a,b){$(".credit-card-wrapper").hide();var c=JSON.parse(a);1==c.status?savedCardDetails():showPopup(c)},failure:function(a,b,c){}};